<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SitRep Pro</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%231a1a1a'/%3E%3Cpath fill='%23d9534f' d='M50 10 C 50 10, 90 25, 90 50 C 90 75, 50 90, 50 90 C 50 90, 10 75, 10 50 C 10 25, 50 10, 50 10 Z'/%3E%3Ctext x='50' y='62' font-size='40' fill='white' text-anchor='middle' font-family='sans-serif' font-weight='bold'%3ES%3C/text%3E%3C/svg%3E">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%231a1a1a'/%3E%3Cpath fill='%23d9534f' d='M50 10 C 50 10, 90 25, 90 50 C 90 75, 50 90, 50 90 C 50 90, 10 75, 10 50 C 10 25, 50 10, 50 10 Z'/%3E%3Ctext x='50' y='62' font-size='40' fill='white' text-anchor='middle' font-family='sans-serif' font-weight='bold'%3ES%3C/text%3E%3C/svg%3E">
    <style>
        :root {
            --primary-bg: #1a1a1a;
            --secondary-bg: #2c2c2c;
            --text-color: #e1e1e1;
            --accent-color: #d9534f;
            --accent-hover: #c9302c;
            --secondary-accent: #5bc0de;
            --secondary-accent-hover: #31b0d5;
            --border-color: #444;
            --input-bg: #333;
            --label-color: #aaa;
            --btn-green: #5cb85c;
            --btn-yellow: #f0ad4e;
            --btn-red: #d9534f;
            --btn-orange: #f89406;
            --btn-blue: #31b0d5;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--primary-bg);
            color: var(--text-color);
            line-height: 1.6;
            padding: 1rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: var(--secondary-bg);
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        }

        header {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-align: center;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 1rem;
            position: relative;
        }
        
        .header-title-group {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header-logo {
            width: 40px;
            height: 40px;
        }

        header h1 {
            color: var(--accent-color);
            font-weight: 600;
            margin: 0;
        }
        
        #last-updated-container {
            position: absolute;
            top: -0.75rem;
            right: 0;
            font-size: 0.7rem;
            color: var(--label-color);
        }

        .control-section, .form-section {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            color: var(--label-color);
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        select, input[type="text"], input[type="number"], textarea {
            width: 100%;
            padding: 0.75rem;
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            border-radius: 4px;
            font-size: 1rem;
        }
        
        input[readonly] {
            background-color: #222;
            color: #888;
        }

        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 5px rgba(217, 83, 79, 0.5);
        }
        
        .form-stack {
             display: grid;
             grid-template-columns: 1fr;
             gap: 1rem;
        }

        fieldset {
            border: 1px solid var(--border-color);
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
        }

        legend {
            padding: 0 0.5rem;
            color: var(--accent-color);
            font-weight: 600;
        }
        
        .incident-details-grid, .imt-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .full-width-item {
            grid-column: 1 / -1;
        }

        .checkbox-group, .radio-group {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.75rem;
        }
        
        @media (min-width: 500px) {
            .checkbox-group, .radio-group {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 0.5rem 1rem;
            }
        }


        .sub-fieldset {
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 0.75rem;
            margin-top: 1rem;
        }
        .sub-fieldset legend {
            font-size: 0.9em;
            font-weight: 500;
            color: var(--label-color);
        }

        .dimension-input-group {
            display: grid;
            grid-template-columns: 1fr auto 1fr auto 1fr;
            align-items: center;
            gap: 0.5rem;
        }
        .dimension-input-group span {
            font-weight: bold;
            color: var(--label-color);
        }
        .sub-text, .advisory-text {
            font-size: 0.8rem;
            color: var(--label-color);
            margin-top: 0.25rem;
        }
        .advisory-text {
            background-color: var(--input-bg);
            padding: 0.5rem;
            border-radius: 4px;
            margin-top: 0.5rem;
            border-left: 3px solid var(--btn-yellow);
            font-weight: bold;
        }

        #property-threatened-group {
            grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
        }
        
        .threat-label {
            color: var(--accent-color);
            font-weight: 600;
        }

        .checkbox-group label, .radio-group label, .inline-checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0;
            color: var(--text-color);
            font-weight: normal;
            transition: color 0.2s;
        }
        
        input[type="checkbox"], input[type="radio"] {
            accent-color: var(--accent-color);
            width: 18px;
            height: 18px;
            flex-shrink: 0;
        }

        .life-status-label.status-red { color: var(--btn-red); font-weight: 600; }
        .life-status-label.status-orange { color: var(--btn-orange); font-weight: 600; }
        .life-status-label.status-green { color: var(--btn-green); font-weight: 600; }

        .button-group {
            display: grid;
            gap: 0.5rem;
        }
        
        .arrival-buttons {
            grid-template-columns: repeat(3, 1fr);
        }

        .warning-buttons {
            grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
        }
        
        .classification-buttons {
             grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        }

        .option-button, .location-btn {
            padding: 0.75rem 0.5rem;
            border: 2px solid var(--border-color);
            background-color: var(--input-bg);
            color: var(--text-color);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 600;
            text-align: center;
            width: 100%;
        }
        
        .location-btn:disabled {
            background-color: #555;
            opacity: 0.6;
            cursor: not-allowed;
            border-color: var(--border-color);
        }
        
        .option-button:hover, .location-btn:not(:disabled):hover {
            border-color: var(--label-color);
        }
        
        .option-button.selected {
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.7);
            border-color: #fff;
        }
        
        .option-button .desc {
            display: block;
            font-size: 0.75rem;
            font-weight: normal;
            opacity: 0.8;
            margin-top: 4px;
        }

        .btn-green { background-color: var(--btn-green); color: white; }
        .btn-yellow { background-color: var(--btn-yellow); color: white; }
        .btn-red { background-color: var(--btn-red); color: white; }
        .btn-orange { background-color: var(--btn-orange); color: white; }
        .btn-darkorange { background-color: #d15b05; color: white; }
        .btn-blue { background-color: var(--btn-blue); color: white; }

        .call-button-container {
            margin: 1.5rem 0;
        }
        .call-button {
            display: block;
            width: 100%;
            padding: 0.8rem;
            background-color: var(--secondary-accent);
            color: white;
            text-decoration: none;
            text-align: center;
            border-radius: 4px;
            font-weight: 600;
            transition: background-color 0.2s ease;
        }
        .call-button:hover {
            background-color: var(--secondary-accent-hover);
        }
        
        .classification-note, .action-note, .sitrep-instruction {
            font-size: 0.8rem;
            color: var(--label-color);
            margin-top: 0.75rem;
            text-align: center;
            background-color: var(--input-bg);
            padding: 0.5rem;
            border-radius: 4px;
        }
        
        .action-note {
            grid-column: 1 / -1; /* Span across all columns in grid */
            margin-top: 0;
        }

        .sitrep-instruction {
            margin-bottom: 1.5rem;
            border: 1px dashed var(--border-color);
        }

        .checklist-form { display: none; }
        .checklist-form.active { display: block; }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }

        @media (min-width: 600px) {
            .action-buttons { grid-template-columns: repeat(2, 1fr); }
        }
        
        .action-button {
            display: block;
            width: 100%;
            padding: 0.8rem;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease, opacity 0.2s ease;
        }
        
        #generate-report-btn { background-color: var(--accent-color); }
        #generate-report-btn:hover { background-color: var(--accent-hover); }

        .dispatch-btn { background-color: var(--secondary-accent); }
        .dispatch-btn:hover { background-color: var(--secondary-accent-hover); }
        .dispatch-btn:disabled { background-color: #555; opacity: 0.6; cursor: not-allowed; }

        #report-output-container {
            margin-top: 1.5rem;
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 1rem;
        }
        
        #report-output-container h3 { color: var(--accent-color); margin-bottom: 0.5rem; }
        #report-output { white-space: pre-wrap; word-wrap: break-word; color: var(--text-color); font-family: "Menlo", "Consolas", monospace; font-size: 0.9rem; }

        .hidden-input, .hidden-section {
            display: none;
        }
        
        .hazmat-checklist-item {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .hazmat-checklist-item label {
            margin-bottom: 0;
        }
        .hazmat-checklist-item input[type="text"] {
            font-size: 0.9rem;
            padding: 0.5rem;
        }
        
        .public-protection-definition {
            font-size: 0.85rem;
            color: var(--label-color);
            padding-left: 2.2rem; /* Align with checkbox text */
            margin-top: 0.25rem;
        }
        .public-protection-definition strong {
            color: var(--text-color);
        }

        .multiple-warning-container {
            border-top: 2px dashed var(--border-color);
            margin-top: 1.5rem;
            padding-top: 1.5rem;
        }

        .direction-grid {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 0.5rem 1.5rem;
            align-items: center;
        }

        .direction-grid input[type="text"] {
            grid-column: 1 / -1;
        }

        @media (max-width: 600px) {
            .direction-grid {
                grid-template-columns: 1fr;
            }
            .direction-grid .compass-grid {
                margin: 0 auto;
            }
        }

        .compass-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            max-width: 250px;
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
        }
        .compass-item {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .compass-item label {
            gap: 0.5rem;
            font-size: 0.9rem;
            margin-bottom: 0;
        }
        .compass-item.center {
            font-weight: bold;
            color: var(--accent-color);
        }

        .objective-grid {
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 0.5rem 1rem;
            align-items: center;
        }
        .objective-grid label {
            margin-bottom: 0;
        }
        .objective-grid select {
            font-size: 0.8rem;
            padding: 0.5rem;
        }

        .lga-input-group {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .lga-input-group input[type="text"] {
            margin-top: 0.5rem;
        }

        .requests-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.5rem;
        }
        .request-item {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.25rem;
            border: 1px solid var(--border-color);
            padding: 0.5rem 0.75rem;
            border-radius: 4px;
        }
        .request-item-label {
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 0;
            font-size: 0.9rem;
        }
        .request-item .radio-group {
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 0.25rem 0.75rem;
        }
        .request-item .radio-group label {
            font-size: 0.8rem;
            gap: 0.3rem;
        }
        .request-via-group {
            background: var(--primary-bg);
            padding: 0.5rem;
            border-radius: 4px;
            margin-top: 0.5rem;
        }
        .request-via-group legend {
            font-size: 0.8rem;
            color: var(--label-color);
            padding: 0 0.25rem;
            font-weight: normal;
        }
        .request-via-group .checkbox-group {
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
        }
        .request-via-group .checkbox-group label {
            font-size: 0.85rem;
        }
        .request-via-group .other-input-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .request-via-group .other-input-group input[type="text"] {
            font-size: 0.85rem;
            padding: 0.4rem;
        }
        hr.request-separator {
            border: none;
            border-top: 1px dashed var(--border-color);
            margin: 1rem 0;
        }
        .appliance-requests-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.75rem;
            margin-top: 1rem;
        }
        .appliance-quantity-group {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .appliance-quantity-group label {
            margin-bottom: 0;
            flex-grow: 1;
        }
        .appliance-quantity-group input[type="number"] {
            width: 70px;
            flex-shrink: 0;
            font-size: 0.9rem;
            padding: 0.5rem;
        }
        #appliance-status-selector.radio-group,
        #support-status-selector.radio-group,
        #intel-status-selector.radio-group {
            grid-template-columns: 1fr 1fr;
        }
        .location-input-group {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 0.5rem;
            align-items: center;
        }
        .location-input-group .full-width-item {
            grid-column: 1 / -1;
        }

        footer {
            text-align: center;
            margin-top: 2rem;
            font-size: 0.8rem;
            color: var(--label-color);
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <div class="header-title-group">
                <svg class="header-logo" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <path fill="#d9534f" d="M50 10 C 50 10, 90 25, 90 50 C 90 75, 50 90, 50 90 C 50 90, 10 75, 10 50 C 10 25, 50 10, 50 10 Z"/>
                    <text x="50" y="62" font-size="40" fill="white" text-anchor="middle" font-family="sans-serif" font-weight="bold">S</text>
                </svg>
                <h1>SitRep Pro</h1>
            </div>
            <p>Select an incident or enter details manually to begin.</p>
            <div id="last-updated-container">Last Updated: <span id="last-updated-time">Never</span></div>
        </header>

        <main>
            <fieldset>
                <legend>Incident Selection</legend>
                <div class="form-stack">
                    <section class="control-section">
                        <label for="global-incident-selector">Select From Active Incidents:</label>
                        <select id="global-incident-selector"><option value="">Loading incidents...</option></select>
                    </section>
                    
                    <p style="text-align: center; color: var(--label-color);">- OR -</p>

                    <section class="form-stack">
                        <label>Edit/Add Incident Details</label>
                        <div class="incident-details-grid">
                            <input type="text" id="manual-incident-number" placeholder="Incident Number" class="full-width-item">
                            <input type="text" id="manual-incident-type" placeholder="Incident Type (e.g., Bushfire)">
                            <input type="text" id="manual-location" placeholder="Location (e.g., Bunbury)">
                        </div>
                    </section>
                </div>
            </fieldset>

            <section class="control-section">
                <label for="checklist-type-selector">Checklist Type:</label>
                <select id="checklist-type-selector">
                    <option value="bushfire">Initial SitRep - Bushfire</option>
                    <option value="structure-fire">Initial SitRep - Structure Fire</option>
                    <option value="road-crash">Initial SitRep - Road Crash Rescue</option>
                    <option value="hazmat">Hazmat</option>
                    <option value="ongoing-bushfire">Ongoing - Bushfire Informative</option>
                </select>
            </section>

            <!-- Bushfire Checklist Form -->
            <form id="bushfire-form" class="checklist-form active">
                <fieldset>
                    <legend>Arrival & Classification</legend>
                    <div class="form-stack">
                        <div>
                            <label>Arrival Code (on arrival)</label>
                            <div class="button-group arrival-buttons">
                                <input type="hidden" name="Arrival Code" id="bf-arrival-code">
                                <button type="button" class="option-button btn-green" data-value="4 4" data-description="Nothing found, investigating, back up normal road.">4 4<span class="desc">Nothing found...</span></button>
                                <button type="button" class="option-button btn-yellow" data-value="6 6" data-description="As reported, incoming resources sufficient.">6 6<span class="desc">As reported...</span></button>
                                <button type="button" class="option-button btn-red" data-value="8 8" data-description="Incident rapidly escalating, Upgrade response 3rd alarm or higher.">8 8<span class="desc">Escalating...</span></button>
                            </div>
                            <div class="advisory-text hidden-input" id="bf-arrival-desc"></div>
                        </div>
                        
                        <div class="call-button-container">
                            <a href="tel:1800198140" class="call-button">Call Comcen - 1800 198 140</a>
                        </div>

                        <div>
                            <label>Classification (within 5 minutes of arrival)</label>
                            <div class="button-group classification-buttons">
                                <input type="hidden" name="Classification" id="bf-classification">
                                <button type="button" class="option-button btn-green" data-value="1st Alarm (1-2 Appliances)">1st Alarm<span class="desc">1-2 Appliances</span></button>
                                <button type="button" class="option-button btn-yellow" data-value="2nd Alarm (2-6 Appliances)">2nd Alarm<span class="desc">2-6 Appliances</span></button>
                                <button type="button" class="option-button btn-orange" data-value="3rd Alarm (6-12 Appliances)">3rd Alarm<span class="desc">6-12 Appliances</span></button>
                                <button type="button" class="option-button btn-red" data-value="4th Alarm (12+ Appliances)">4th Alarm<span class="desc">12+ Appliances</span></button>
                            </div>
                        </div>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>PAFTACS Report (within 15 minutes)</legend>
                    <div class="form-stack">
                        <div>
                            <label>P: Position</label>
                            <div class="form-stack">
                                <button type="button" class="location-btn" id="bf-get-location-btn">Get Current Position</button>
                                <label class="inline-checkbox-label">
                                    <input type="checkbox" id="bf-pos-manual-checkbox" class="pos-manual-checkbox"> Enter Position Manually
                                </label>
                                <p class="sub-text" style="margin-top: -0.5rem;">Ensure location services enabled on device</p>
                                <input type="text" id="bf-lat-long" name="Lat/Long" placeholder="Lat/Long" readonly>
                                <input type="text" id="bf-street-address" name="Street Address" placeholder="Street Address" readonly>
                                <div class="direction-grid">
                                    <label for="bf-direction-travel">Fire's Direction of Travel</label>
                                    <div class="compass-grid">
                                        <div class="compass-item"><label><input type="checkbox" value="NW">NW</label></div>
                                        <div class="compass-item"><label><input type="checkbox" value="N">N</label></div>
                                        <div class="compass-item"><label><input type="checkbox" value="NE">NE</label></div>
                                        <div class="compass-item"><label><input type="checkbox" value="W">W</label></div>
                                        <div class="compass-item center">DIR</div>
                                        <div class="compass-item"><label><input type="checkbox" value="E">E</label></div>
                                        <div class="compass-item"><label><input type="checkbox" value="SW">SW</label></div>
                                        <div class="compass-item"><label><input type="checkbox" value="S">S</label></div>
                                        <div class="compass-item"><label><input type="checkbox" value="SE">SE</label></div>
                                    </div>
                                    <input type="text" id="bf-direction-travel" name="Fire's Direction of Travel" placeholder="Select from compass or type...">
                                </div>
                            </div>
                        </div>
                        <div>
                            <strong class="threat-label">Property Threatened:</strong>
                            <div id="property-threatened-group" class="checkbox-group" style="margin-top: 0.5rem;">
                                <label><input type="checkbox" name="Property Threatened" value="Nil">Nil</label>
                                <label><input type="checkbox" name="Property Threatened" value="Lives">Lives</label>
                                <label><input type="checkbox" name="Property Threatened" value="Houses">Houses</label>
                                <label><input type="checkbox" name="Property Threatened" value="Livestock">Livestock</label>
                                <label><input type="checkbox" name="Property Threatened" value="Critical Infrastructure">Critical Infrastructure</label>
                            </div>
                        </div>
                        <div>
                            <label>A: Area Involved</label>
                            <div class="radio-group" id="area-unit-selector" style="grid-template-columns: 1fr 1fr; margin-bottom: 0.5rem;">
                                <label><input type="radio" name="AreaUnit" value="hectares" checked> Hectares</label>
                                <label><input type="radio" name="AreaUnit" value="metres"> Metres (m x m)</label>
                            </div>
                            <div id="area-hectares-input-group">
                                <input type="number" id="a-area-ha" name="Area (ha)" placeholder="Hectares">
                            </div>
                            <div id="area-metres-input-group" class="hidden-input">
                                <div class="dimension-input-group">
                                    <input type="number" id="a-area-m1" name="Area Metres 1" aria-label="Area dimension 1" placeholder="length">
                                    <span>X</span>
                                    <input type="number" id="a-area-m2" name="Area Metres 2" aria-label="Area dimension 2" placeholder="width">
                                    <span>=</span>
                                    <input type="text" id="a-area-sqm" name="Area SqM" readonly placeholder="0 m²">
                                </div>
                            </div>
                        </div>
                        <div>
                            <label>F: Fuel</label>
                            <div class="form-stack">
                                <label for="f-fuel-load">Fuel Load</label>
                                <select id="f-fuel-load" name="Fuel Load" title="Fuel Load"><option>Light</option><option>Moderate</option><option>Heavy</option></select>
                                <label for="f-fuel-type">Fuel Type</label>
                                <select id="f-fuel-type" name="Fuel Type" title="Fuel Type"><option>Grass</option><option>Scrub/Shrubland</option><option>Woodland</option><option>Forest/Plantation</option></select>
                                <label for="f-fire-intensity">Fire Intensity</label>
                                <select id="f-fire-intensity" name="Fire Intensity" title="Fire Intensity"><option>Low</option><option>Moderate</option><option>High</option><option>Extreme</option></select>
                            </div>
                        </div>
                        <div><label for="t-time">T: Estimated Time to Control</label><input type="text" id="t-time" name="Time to Control"></div>
                        <div>
                            <label>A: Assistance Required</label>
                            <fieldset class="sub-fieldset">
                                <legend>Resources</legend>
                                <div class="radio-group" id="appliance-status-selector">
                                    <label><input type="radio" name="ApplianceStatus" value="Sufficient" checked> Resources Sufficient</label>
                                    <label><input type="radio" name="ApplianceStatus" value="RequireAdditional"> Require Additional Resources</label>
                                </div>
                                <div id="resource-request-details" class="hidden-input">
                                    <div class="appliance-requests-grid">
                                        <div class="appliance-quantity-group"><label><input type="checkbox" class="quantity-checkbox" data-input-id="frs-qty"> FRS</label><input type="number" id="frs-qty" name="FRS Required" min="0" placeholder="Qty" class="hidden-input"></div>
                                        <div class="appliance-quantity-group"><label><input type="checkbox" class="quantity-checkbox" data-input-id="heavies-qty"> Heavies</label><input type="number" id="heavies-qty" name="Heavies Required" min="0" placeholder="Qty" class="hidden-input"></div>
                                        <div class="appliance-quantity-group"><label><input type="checkbox" class="quantity-checkbox" data-input-id="lights-qty"> Lights</label><input type="number" id="lights-qty" name="Lights Required" min="0" placeholder="Qty" class="hidden-input"></div>
                                        <div class="appliance-quantity-group"><label><input type="checkbox" class="quantity-checkbox" data-input-id="bulk-water-qty"> Bulk Water</label><input type="number" id="bulk-water-qty" name="Bulk Water Required" min="0" placeholder="Qty" class="hidden-input"></div>
                                        <div>
                                            <div class="appliance-quantity-group">
                                                <label><input type="checkbox" class="quantity-checkbox" data-input-id="machinery-qty" data-desc-id="machinery-desc"> Machinery</label>
                                                <input type="number" id="machinery-qty" name="Machinery Required" min="0" placeholder="Qty" class="hidden-input">
                                            </div>
                                            <input type="text" id="machinery-desc" name="Machinery Description" placeholder="What Machinery?" class="hidden-input" style="margin-top: 0.5rem;">
                                        </div>
                                        <div>
                                            <div class="appliance-quantity-group">
                                                <label><input type="checkbox" class="quantity-checkbox" data-input-id="other-appliance-qty" data-desc-id="other-appliance-desc"> Other</label>
                                                <input type="number" id="other-appliance-qty" name="Other Appliance Required" min="0" placeholder="Qty" class="hidden-input">
                                            </div>
                                            <input type="text" id="other-appliance-desc" name="Other Appliance Description" placeholder="Specify Other" class="hidden-input" style="margin-top: 0.5rem;">
                                        </div>
                                    </div>
                                    <hr class="request-separator">
                                    <div class="requests-grid" id="bf-resource-requests">
                                        <!-- Air Support & Asset Protection injected here -->
                                    </div>
                                </div>
                            </fieldset>
                            <fieldset class="sub-fieldset">
                                <legend>Support</legend>
                                <div class="radio-group" id="support-status-selector">
                                    <label><input type="radio" name="SupportStatus" value="NotRequired" checked> No Support Required</label>
                                    <label><input type="radio" name="SupportStatus" value="Required"> Support Required</label>
                                </div>
                                <div id="support-request-details" class="hidden-input" style="margin-top: 1rem;">
                                    <div class="requests-grid" id="bf-support-requests">
                                        <!-- Support agencies injected here -->
                                    </div>
                                </div>
                            </fieldset>
                            <fieldset class="sub-fieldset">
                                <legend>Intel</legend>
                                <div class="radio-group" id="intel-status-selector">
                                    <label><input type="radio" name="IntelStatus" value="NotRequired" checked> Intel Not Required</label>
                                    <label><input type="radio" name="IntelStatus" value="Required"> Intel Required</label>
                                </div>
                                <div id="intel-request-details" class="hidden-input" style="margin-top: 1rem;">
                                    <div class="requests-grid" id="bf-intel-requests">
                                        <!-- Intel products injected here -->
                                    </div>
                                </div>
                            </fieldset>
                            <div style="margin-top: 1rem;">
                                <label for="additional-resources">Additional Details / Other Requests</label>
                                <input type="text" id="additional-resources" name="Additional Resource Details">
                            </div>
                        </div>
                        <div>
                            <label>C: Communications & Control</label>
                            <div class="form-stack">
                                <input type="text" id="bf-incident-name" name="Incident Name" placeholder="Auto-generated Incident Name" readonly>
                                <label class="inline-checkbox-label">
                                    <input type="checkbox" id="bf-name-manually-checkbox" class="name-manually-checkbox"> Name Manually
                                </label>
                                <div>
                                    <label for="bf-managed-under">Fire being managed under:</label>
                                    <select id="bf-managed-under" name="Managed Under">
                                        <option>Bushfires Act 1954</option>
                                        <option>Fire Brigades Act 1942</option>
                                        <option value="Other">Other</option>
                                    </select>
                                    <input type="text" id="bf-managed-under-other" name="Managed Under Other" placeholder="Specify other" class="hidden-input" style="margin-top: 0.5rem;">
                                </div>
                                <div>
                                    <label>Controlling Agency:</label>
                                    <div class="checkbox-group" id="bf-controlling-agency-group">
                                        <label><input type="checkbox" name="Controlling Agency" value="DFES">DFES</label>
                                        <label><input type="checkbox" name="Controlling Agency" value="DBCA">DBCA</label>
                                        <div class="lga-input-group">
                                            <label class="inline-checkbox-label"><input type="checkbox" id="bf-lga-checkbox" name="Controlling Agency" value="LGA">LGA</label>
                                            <input type="text" id="bf-lga-name" name="LGA Name" class="hidden-input" placeholder="Enter LGA Name">
                                        </div>
                                    </div>
                                </div>
                                <input type="text" id="bf-command-channel" name="Command Channel" placeholder="Command Channel">
                                <div>
                                    <label for="bf-control-point">Control Point</label>
                                    <div class="location-input-group">
                                        <input type="text" id="bf-control-point" name="Control Point" placeholder="Control Point" readonly>
                                        <button type="button" id="bf-cp-location-btn" class="location-btn" style="padding: 0.5rem;">My Location</button>
                                        <div class="full-width-item">
                                            <label class="inline-checkbox-label">
                                                <input type="checkbox" id="bf-cp-manual-checkbox" class="cp-manual-checkbox"> Enter Manually
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <fieldset class="sub-fieldset">
                                    <legend>Command Structure</legend>
                                    <div class="form-stack">
                                        <input type="text" id="bf-incident-controller" name="Incident Controller" placeholder="Incident Controller">
                                        <input type="text" id="bf-operations-officer" name="Operations Officer" placeholder="Operations Officer">
                                        <input type="text" id="bf-bflo" name="BFLO" placeholder="Bushfire Liaison Officers (BFLO)">
                                    </div>
                                </fieldset>
                            </div>
                        </div>
                        <div>
                            <label>S: Surface Winds & Safety</label>
                            <div class="form-stack">
                                <input type="text" id="wind-details" name="Wind Direction and Strength" placeholder="Wind Direction and Strength">
                                <textarea id="safety-concerns" name="Safety Concerns" rows="3" placeholder="Safety Concerns (Red Flag Warnings)"></textarea>
                            </div>
                        </div>
                    </div>
                </fieldset>
                
                <fieldset>
                    <legend>Public Information</legend>
                    <!-- Warning 1 -->
                    <div id="bf-warning-1-container">
                        <div class="form-stack">
                            <div>
                                <label>Warning Level</label>
                                <div class="button-group warning-buttons" data-warning-id="bf-1">
                                    <input type="hidden" name="Warning Level 1" id="bf-warning-level-1">
                                    <button type="button" class="option-button btn-blue" data-value="No Warning Required">No Warning Required</button>
                                    <button type="button" class="option-button btn-yellow" data-value="Advice">Advice</button>
                                    <button type="button" class="option-button btn-orange" data-value="Watch and Act">Watch and Act</button>
                                    <button type="button" class="option-button btn-red" data-value="Emergency Warning">Emergency Warning</button>
                                </div>
                            </div>
                            <div>
                                <label for="bf-action-statement-1">Action Statement</label>
                                <select name="Action Statement 1" id="bf-action-statement-1"></select>
                            </div>
                            <div>
                                <label>Warning Boundaries</label>
                                <div class="form-stack" style="margin-top: 0.5rem;">
                                    <input type="text" id="bf-n-boundary-1" name="Northern Boundary 1" placeholder="Northern Boundary">
                                    <input type="text" id="bf-e-boundary-1" name="Eastern Boundary 1" placeholder="Eastern Boundary">
                                    <input type="text" id="bf-s-boundary-1" name="Southern Boundary 1" placeholder="Southern Boundary">
                                    <input type="text" id="bf-w-boundary-1" name="Western Boundary 1" placeholder="Western Boundary">
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Warning 2 -->
                    <div id="bf-warning-2-container" class="multiple-warning-container hidden-section">
                        <legend>Warning Area 2</legend>
                        <div class="form-stack">
                            <div>
                                <label>Warning Level</label>
                                <div class="button-group warning-buttons" data-warning-id="bf-2">
                                    <input type="hidden" name="Warning Level 2" id="bf-warning-level-2">
                                    <button type="button" class="option-button btn-blue" data-value="No Warning Required">No Warning Required</button>
                                    <button type="button" class="option-button btn-yellow" data-value="Advice">Advice</button>
                                    <button type="button" class="option-button btn-orange" data-value="Watch and Act">Watch and Act</button>
                                    <button type="button" class="option-button btn-red" data-value="Emergency Warning">Emergency Warning</button>
                                </div>
                            </div>
                            <div>
                                <label for="bf-action-statement-2">Action Statement</label>
                                <select name="Action Statement 2" id="bf-action-statement-2"></select>
                            </div>
                            <div>
                                <label>Warning Boundaries</label>
                                <div class="form-stack" style="margin-top: 0.5rem;">
                                    <input type="text" id="bf-n-boundary-2" name="Northern Boundary 2" placeholder="Northern Boundary">
                                    <input type="text" id="bf-e-boundary-2" name="Eastern Boundary 2" placeholder="Eastern Boundary">
                                    <input type="text" id="bf-s-boundary-2" name="Southern Boundary 2" placeholder="Southern Boundary">
                                    <input type="text" id="bf-w-boundary-2" name="Western Boundary 2" placeholder="Western Boundary">
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Warning 3 -->
                     <div id="bf-warning-3-container" class="multiple-warning-container hidden-section">
                        <legend>Warning Area 3</legend>
                        <div class="form-stack">
                            <div>
                                <label>Warning Level</label>
                                <div class="button-group warning-buttons" data-warning-id="bf-3">
                                    <input type="hidden" name="Warning Level 3" id="bf-warning-level-3">
                                    <button type="button" class="option-button btn-blue" data-value="No Warning Required">No Warning Required</button>
                                    <button type="button" class="option-button btn-yellow" data-value="Advice">Advice</button>
                                    <button type="button" class="option-button btn-orange" data-value="Watch and Act">Watch and Act</button>
                                    <button type="button" class="option-button btn-red" data-value="Emergency Warning">Emergency Warning</button>
                                </div>
                            </div>
                            <div>
                                <label for="bf-action-statement-3">Action Statement</label>
                                <select name="Action Statement 3" id="bf-action-statement-3"></select>
                            </div>
                            <div>
                                <label>Warning Boundaries</label>
                                <div class="form-stack" style="margin-top: 0.5rem;">
                                    <input type="text" id="bf-n-boundary-3" name="Northern Boundary 3" placeholder="Northern Boundary">
                                    <input type="text" id="bf-e-boundary-3" name="Eastern Boundary 3" placeholder="Eastern Boundary">
                                    <input type="text" id="bf-s-boundary-3" name="Southern Boundary 3" placeholder="Southern Boundary">
                                    <input type="text" id="bf-w-boundary-3" name="Western Boundary 3" placeholder="Western Boundary">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 1.5rem;">
                        <label class="inline-checkbox-label" id="bf-add-warning-2-label">
                            <input type="checkbox" id="bf-add-warning-2-checkbox"> Add a second Warning Area
                        </label>
                         <label class="inline-checkbox-label hidden-section" id="bf-add-warning-3-label">
                            <input type="checkbox" id="bf-add-warning-3-checkbox"> Add a third Warning Area
                        </label>
                    </div>
                    <div class="call-button-container" style="margin-bottom: 0; margin-top: 1.5rem;">
                        <a href="tel:1800718288" class="call-button">Call Coordinator Public Info (CPI) - 1800 718 288</a>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>Report Author</legend>
                    <div class="form-stack">
                         <label for="bf-report-completed-by">Report Completed By</label>
                         <input type="text" id="bf-report-completed-by" name="Report Completed By">
                         <div class="radio-group" id="bf-author-role-selector" style="grid-template-columns: 1fr;">
                            <label><input type="radio" name="ReportAuthorRole" value="is_ic"> I am the IC</label>
                            <label><input type="radio" name="ReportAuthorRole" value="on_behalf" checked> Completed on behalf of IC</label>
                         </div>
                         <div id="bf-ic-author-group" class="form-stack">
                            <label for="bf-incident-controller-author">Incident Controller</label>
                            <input type="text" id="bf-incident-controller-author" name="Incident Controller Author">
                         </div>
                    </div>
                </fieldset>
            </form>

            <!-- Structure Fire Checklist Form -->
            <form id="structure-fire-form" class="checklist-form">
                <fieldset>
                    <legend>Arrival & Classification</legend>
                    <div class="form-stack">
                        <div>
                            <label>Arrival Code (on arrival)</label>
                            <div class="button-group arrival-buttons">
                                <input type="hidden" name="Arrival Code" id="sf-arrival-code">
                                <button type="button" class="option-button btn-green" data-value="4 4" data-description="Nothing found, investigating, back up normal road.">4 4<span class="desc">Nothing found...</span></button>
                                <button type="button" class="option-button btn-yellow" data-value="6 6" data-description="As reported, incoming resources sufficient.">6 6<span class="desc">As reported...</span></button>
                                <button type="button" class="option-button btn-red" data-value="8 8" data-description="Incident rapidly escalating, Upgrade response 3rd alarm or higher.">8 8<span class="desc">Escalating...</span></button>
                            </div>
                            <div class="advisory-text hidden-input" id="sf-arrival-desc"></div>
                        </div>

                        <div class="call-button-container">
                            <a href="tel:1800198140" class="call-button">Call Comcen - 1800 198 140</a>
                        </div>

                        <div>
                            <label>Classification (within 5 minutes of arrival)</label>
                            <div class="button-group classification-buttons">
                                <input type="hidden" name="Classification" id="sf-classification">
                                <button type="button" class="option-button btn-green" data-value="1st Alarm">1st Alarm</button>
                                <button type="button" class="option-button btn-yellow" data-value="2nd Alarm">2nd Alarm</button>
                                <button type="button" class="option-button btn-orange" data-value="3rd Alarm">3rd Alarm</button>
                                <button type="button" class="option-button btn-darkorange" data-value="4th Alarm">4th Alarm</button>
                                <button type="button" class="option-button btn-red" data-value="5th Alarm">5th Alarm</button>
                            </div>
                            <p class="classification-note">1 Alarm = 1 FRS Appliance (3.4U, HSR, CP), BA operations require 2nd Alarm or Higher.</p>
                        </div>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>Confirmed Location</legend>
                    <div class="form-stack">
                        <button type="button" class="location-btn" id="sf-get-location-btn">Confirm Location</button>
                        <label class="inline-checkbox-label">
                            <input type="checkbox" id="sf-pos-manual-checkbox" class="pos-manual-checkbox"> Enter Position Manually
                        </label>
                        <p class="sub-text" style="margin-top: -0.5rem;">Ensure location services enabled on device</p>
                        <input type="text" id="sf-lat-long" name="Lat/Long" placeholder="Lat/Long" readonly>
                        <input type="text" id="sf-street-address" name="Street Address" placeholder="Street Address" readonly>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>HAULER Report (within 15 minutes)</legend>
                    <div class="form-stack">
                        <div>
                            <label>H: Height</label>
                            <div class="checkbox-group">
                                <label><input type="checkbox" name="Height" value="1 Storey">1 Storey</label>
                                <label><input type="checkbox" name="Height" value="2 Storey">2 Storey</label>
                                <label><input type="checkbox" name="Height" value="3 Storey">3 Storey</label>
                                <label><input type="checkbox" class="toggle-input-checkbox" data-target="multi-storey-input">Multi-Storey</label>
                            </div>
                            <input type="text" id="multi-storey-input" name="Height Specify" placeholder="Specify stories" class="hidden-input">
                        </div>
                        <div>
                            <label>A: Area/Size</label>
                            <div class="dimension-input-group" style="grid-template-columns: 1fr auto 1fr;">
                                <input type="text" id="sf-area-dim-1" name="Area Dim 1" aria-label="Area dimension 1">
                                <span>X</span>
                                <input type="text" id="sf-area-dim-2" name="Area Dim 2" aria-label="Area dimension 2">
                            </div>
                            <p class="sub-text">e.g., 3x2 or 20m x 10m</p>
                        </div>
                        <div>
                            <label>U: Use / Construction</label>
                            <fieldset class="sub-fieldset">
                                <legend>Use</legend>
                                <div class="checkbox-group">
                                    <label><input type="checkbox" name="Use" value="Residential">Residential</label>
                                    <label><input type="checkbox" name="Use" value="Commercial">Commercial</label>
                                    <label><input type="checkbox" name="Use" value="Industrial">Industrial</label>
                                    <label><input type="checkbox" class="toggle-input-checkbox" data-target="use-other-input">Other</label>
                                </div>
                                <input type="text" id="use-other-input" name="Use Other" placeholder="Specify other use" class="hidden-input">
                            </fieldset>
                            <fieldset class="sub-fieldset">
                                <legend>Construction</legend>
                                <label>Walls:</label>
                                <div class="checkbox-group">
                                    <label><input type="checkbox" name="Walls" value="Brick">Brick</label>
                                    <label><input type="checkbox" name="Walls" value="Weather Board">Weather Board</label>
                                    <label><input type="checkbox" name="Walls" value="Timber">Timber</label>
                                    <label><input type="checkbox" name="Walls" value="Tin">Tin</label>
                                    <label><input type="checkbox" class="toggle-input-checkbox" data-target="walls-other-input">Other</label>
                                </div>
                                <input type="text" id="walls-other-input" name="Walls Other" placeholder="Specify other wall material" class="hidden-input">
                                <label style="margin-top: 1rem;">Roof:</label>
                                <div class="checkbox-group">
                                    <label><input type="checkbox" name="Roof" value="Tin">Tin</label>
                                    <label><input type="checkbox" name="Roof" value="Tile">Tile</label>
                                    <label><input type="checkbox" class="toggle-input-checkbox" data-target="roof-other-input">Other</label>
                                </div>
                                <input type="text" id="roof-other-input" name="Roof Other" placeholder="Specify other roof material" class="hidden-input">
                                <div class="checkbox-group" style="margin-top: 1rem;">
                                    <label><input type="checkbox" name="Asbestos" value="Possible Asbestos">Possible Asbestos</label>
                                    <label><input type="checkbox" name="Asbestos" value="Confirmed Asbestos">Confirmed Asbestos</label>
                                    <label><input type="checkbox" name="Asbestos" value="No Asbestos Risk">No Asbestos Risk</label>
                                </div>
                            </fieldset>
                        </div>
                        <div>
                            <label>L: Lines of Hose / Actions</label>
                            <div class="form-stack">
                                <fieldset class="sub-fieldset">
                                    <legend>Lines of Hose</legend>
                                    <div class="checkbox-group">
                                        <label><input type="checkbox" name="Lines of Hose" value="1 Line">1 Line</label>
                                        <label><input type="checkbox" name="Lines of Hose" value="2 Lines">2 Lines</label>
                                        <label><input type="checkbox" class="toggle-input-checkbox" data-target="sf-lines-other-input">Other</label>
                                    </div>
                                    <input type="text" id="sf-lines-other-input" name="Lines of Hose Other" placeholder="Specify number of lines" class="hidden-input">
                                </fieldset>
                                <fieldset class="sub-fieldset">
                                    <legend>BA Teams</legend>
                                    <div class="checkbox-group">
                                        <label><input type="checkbox" name="BA Teams" value="1 Team of BA">1 Team of BA</label>
                                        <label><input type="checkbox" name="BA Teams" value="2 Teams of BA">2 Teams of BA</label>
                                        <label><input type="checkbox" class="toggle-input-checkbox" data-target="sf-ba-teams-other-input">Other</label>
                                    </div>
                                    <input type="text" id="sf-ba-teams-other-input" name="BA Teams Other" placeholder="Specify number of teams" class="hidden-input">
                                </fieldset>
                                <fieldset class="sub-fieldset">
                                    <legend>Actions</legend>
                                    <div class="checkbox-group">
                                        <label><input type="checkbox" name="Actions" value="Conducting Primary Search">Conducting Primary Search</label>
                                        <label><input type="checkbox" name="Actions" value="Protecting Exposures">Protecting Exposures</label>
                                        <label><input type="checkbox" name="Actions" value="Power and Gas Isolated">Power and Gas Isolated</label>
                                        <label><input type="checkbox" class="toggle-input-checkbox" data-target="sf-actions-other-input">Other</label>
                                    </div>
                                    <input type="text" id="sf-actions-other-input" name="Actions Other" placeholder="Specify other action" class="hidden-input">
                                </fieldset>
                            </div>
                        </div>
                        <div>
                            <label>E: Exposures / Evacuations</label>
                            <div class="form-stack">
                                <fieldset class="sub-fieldset">
                                    <legend>Exposures</legend>
                                    <div class="checkbox-group" id="sf-exposures-group">
                                        <label><input type="checkbox" name="Exposures" value="No Exposures">No Exposures</label>
                                        <label><input type="checkbox" name="Exposures" value="Exposure">Exposure</label>
                                        <label><input type="checkbox" name="Exposures" value="Multiple Exposures">Multiple Exposures</label>
                                    </div>
                                    <input type="text" id="sf-exposures-location-input" name="Location of Exposures" placeholder="Specify location(s) of exposures" class="hidden-input">
                                </fieldset>
                                <div>
                                    <label class="inline-checkbox-label">
                                        <input type="checkbox" id="sf-evacuation-checkbox" class="toggle-input-checkbox" data-target="sf-evacuations-input"> Evacuation in Progress/Required
                                    </label>
                                    <input type="text" id="sf-evacuations-input" name="Evacuations" placeholder="Evacuation details..." class="hidden-input" style="margin-top: 0.5rem;">
                                </div>
                                <div class="radio-group" id="life-involvement-group">
                                    <label class="life-status-label status-red"><input type="radio" name="Life Involvement" value="Life Involvement Confirmed">Life Involvement Confirmed</label>
                                    <label class="life-status-label status-orange"><input type="radio" name="Life Involvement" value="Life Involvement not confirmed">Life Involvement not confirmed</label>
                                    <label class="life-status-label status-green"><input type="radio" name="Life Involvement" value="Confirmed No Life involvement">Confirmed No Life involvement</label>
                                </div>
                                <div id="persons-unaccounted-container" class="hidden-input">
                                    <label for="persons-unaccounted-input">Number of Persons Unaccounted for</label>
                                    <input type="text" id="persons-unaccounted-input" name="Number of Persons Unaccounted for">
                                </div>
                                <div id="possible-persons-container" class="hidden-input">
                                    <label for="possible-persons-input">Possible Persons Unaccounted for</label>
                                    <input type="text" id="possible-persons-input" name="Possible Persons Unaccounted for">
                                </div>
                            </div>
                        </div>
                        <div>
                            <label>R: Resources</label>
                            <fieldset class="sub-fieldset">
                                <legend>Required</legend>
                                <div class="checkbox-group">
                                    <div class="appliance-quantity-group">
                                        <label><input type="checkbox" class="quantity-checkbox" data-input-id="sf-add-pump-qty"> Additional Pump</label>
                                        <input type="number" id="sf-add-pump-qty" name="Additional Pump Qty" min="0" placeholder="Qty" class="hidden-input">
                                    </div>
                                    <label><input type="checkbox" name="Resources Required" value="SET/BA Support">SET/BA Support</label>
                                    <label><input type="checkbox" name="Resources Required" value="CLP/Aerial Platform">CLP/Aerial Platform</label>
                                    <label><input type="checkbox" name="Resources Required" value="DFES Officer">DFES Officer</label>
                                    <label><input type="checkbox" name="Resources Required" value="WAPOL">WAPOL</label>
                                    <label><input type="checkbox" name="Resources Required" value="Western Power">Western Power</label>
                                    <label><input type="checkbox" name="Resources Required" value="SJA">SJA</label>
                                    <label><input type="checkbox" name="Resources Required" value="LGA Rep">LGA Rep</label>
                                    <label><input type="checkbox" name="Resources Required" value="FIO">FIO</label>
                                    <label><input type="checkbox" class="toggle-input-checkbox" data-target="resources-required-other-input">Other</label>
                                </div>
                                <input type="text" id="resources-required-other-input" name="Resources Required Other" placeholder="Specify other required resource" class="hidden-input">
                            </fieldset>
                            <fieldset class="sub-fieldset">
                                <legend>In Attendance</legend>
                                <div class="checkbox-group">
                                    <label><input type="checkbox" name="Resources In Attendance" value="DFES Officer">DFES Officer</label>
                                    <label><input type="checkbox" name="Resources In Attendance" value="WAPOL">WAPOL</label>
                                    <label><input type="checkbox" name="Resources In Attendance" value="Western Power">Western Power</label>
                                    <label><input type="checkbox" name="Resources In Attendance" value="SJA">SJA</label>
                                    <label><input type="checkbox" name="Resources In Attendance" value="LGA Rep">LGA Rep</label>
                                    <label><input type="checkbox" name="Resources In Attendance" value="FIO">FIO</label>
                                    <label><input type="checkbox" class="toggle-input-checkbox" data-target="resources-attendance-other-input">Other</label>
                                </div>
                                <input type="text" id="resources-attendance-other-input" name="Resources In Attendance Other" placeholder="Specify other resource in attendance" class="hidden-input">
                            </fieldset>
                        </div>
                        <div>
                            <label>S: Staging Area / Safety</label>
                             <div class="form-stack">
                                <input type="text" id="sf-incident-name" name="Incident Name" placeholder="Auto-generated Incident Name" readonly>
                                <label class="inline-checkbox-label">
                                    <input type="checkbox" id="sf-name-manually-checkbox" class="name-manually-checkbox"> Name Manually
                                </label>
                                <div>
                                    <label>Command Channel</label>
                                    <div class="checkbox-group" style="grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));">
                                        <label><input type="checkbox" name="Command Channel" value="CMD1"> CMD1</label>
                                        <label><input type="checkbox" name="Command Channel" value="CMD2"> CMD2</label>
                                        <label><input type="checkbox" name="Command Channel" value="BA A"> BA A</label>
                                        <label><input type="checkbox" class="toggle-input-checkbox" data-target="sf-cmd-channel-other"> Other</label>
                                    </div>
                                    <input type="text" id="sf-cmd-channel-other" name="Command Channel Other" class="hidden-input" placeholder="Specify other channel" style="margin-top: 0.5rem;">
                                </div>
                                <div>
                                    <label for="sf-control-point">Control Point</label>
                                    <div class="location-input-group">
                                        <input type="text" id="sf-control-point" name="Control Point" placeholder="Control Point" readonly>
                                        <button type="button" id="sf-cp-location-btn" class="location-btn" style="padding: 0.5rem;">My Location</button>
                                        <div class="full-width-item">
                                            <label class="inline-checkbox-label">
                                                <input type="checkbox" id="sf-cp-manual-checkbox" class="cp-manual-checkbox"> Enter Manually
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <input type="text" id="sf-incident-controller" name="Incident Controller Main" placeholder="Incident Controller">
                                <input type="text" id="sf-operations-officer" name="Operations Officer" placeholder="Operations Officer">
                            </div>
                        </div>
                    </div>
                </fieldset>
                <fieldset>
                    <legend>Public Information</legend>
                    <div class="form-stack">
                        <div>
                            <label>Warning Level</label>
                            <div class="button-group warning-buttons">
                                <input type="hidden" name="Warning Level" id="sf-warning-level">
                                <button type="button" class="option-button btn-blue" data-value="No Warning Required">No Warning Required</button>
                                <button type="button" class="option-button btn-green" data-value="Smoke Alert">Smoke Alert</button>
                            </div>
                        </div>
                        <div>
                            <label for="sf-smoke-direction">Smoke Direction</label>
                            <input type="text" id="sf-smoke-direction" name="Smoke Direction" placeholder="e.g., North-easterly">
                        </div>
                        <div>
                            <label for="sf-community-impact">Community Impact</label>
                            <textarea id="sf-community-impact" name="Community Impact" rows="3" placeholder="e.g., Smoke affecting nearby suburbs, road closures..."></textarea>
                        </div>
                        <div class="call-button-container" style="margin-bottom: 0;">
                            <a href="tel:1800718288" class="call-button">Call Coordinator Public Info (CPI) - 1800 718 288</a>
                        </div>
                    </div>
                </fieldset>
                <fieldset>
                    <legend>Report Author</legend>
                    <div class="form-stack">
                         <label for="sf-report-completed-by">Report Completed By</label>
                         <input type="text" id="sf-report-completed-by" name="Report Completed By">
                         <div class="radio-group" id="sf-author-role-selector" style="grid-template-columns: 1fr;">
                            <label><input type="radio" name="ReportAuthorRole" value="is_ic"> I am the IC</label>
                            <label><input type="radio" name="ReportAuthorRole" value="on_behalf" checked> Completed on behalf of IC</label>
                         </div>
                         <div id="sf-ic-author-group" class="form-stack">
                             <label for="sf-incident-controller-author">Incident Controller</label>
                             <input type="text" id="sf-incident-controller-author" name="Incident Controller">
                         </div>
                    </div>
                </fieldset>
            </form>

            <!-- Road Crash Checklist Form -->
            <form id="road-crash-form" class="checklist-form">
                <fieldset>
                    <legend>Arrival & Classification</legend>
                    <div class="form-stack">
                        <div>
                            <label>Arrival Code (on arrival)</label>
                            <div class="button-group arrival-buttons">
                                <input type="hidden" name="Arrival Code" id="rcr-arrival-code">
                                <button type="button" class="option-button btn-green" data-value="4 4" data-description="Nothing found, investigating, back up normal road.">4 4<span class="desc">Nothing found...</span></button>
                                <button type="button" class="option-button btn-yellow" data-value="6 6" data-description="As reported, incoming resources sufficient.">6 6<span class="desc">As reported...</span></button>
                                <button type="button" class="option-button btn-red" data-value="8 8" data-description="Incident rapidly escalating, Upgrade response 3rd alarm or higher.">8 8<span class="desc">Escalating...</span></button>
                            </div>
                             <div class="advisory-text hidden-input" id="rcr-arrival-desc"></div>
                        </div>

                        <div class="call-button-container">
                            <a href="tel:1800198140" class="call-button">Call Comcen - 1800 198 140</a>
                        </div>

                        <div>
                            <label>Classification (within 5 minutes of arrival)</label>
                            <div class="button-group classification-buttons">
                                <input type="hidden" name="Classification" id="rcr-classification">
                                <button type="button" class="option-button btn-green" data-value="1st Alarm (No Entrapment)">1st Alarm<span class="desc">No Entrapment</span></button>
                                <button type="button" class="option-button btn-yellow" data-value="2nd Alarm (Entrapment)">2nd Alarm<span class="desc">Entrapment</span></button>
                                <button type="button" class="option-button btn-red" data-value="3rd Alarm (Heavy Rescue, Complex Rescue)">3rd Alarm<span class="desc">Heavy/Complex Rescue</span></button>
                            </div>
                        </div>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>Confirmed Location</legend>
                    <div class="form-stack">
                        <button type="button" class="location-btn" id="rcr-get-location-btn">Confirm Location</button>
                        <label class="inline-checkbox-label">
                            <input type="checkbox" id="rcr-pos-manual-checkbox" class="pos-manual-checkbox"> Enter Position Manually
                        </label>
                        <p class="sub-text" style="margin-top: -0.5rem;">Ensure location services enabled on device</p>
                        <input type="text" id="rcr-lat-long" name="Lat/Long" placeholder="Lat/Long" readonly>
                        <input type="text" id="rcr-street-address" name="Street Address" placeholder="Street Address" readonly>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>SITREP (within 15 minutes)</legend>
                    <div class="form-stack">
                        <div>
                            <label>Situation</label>
                            <div class="checkbox-group">
                                <label><input type="checkbox" name="Situation" value="Car vs Tree">Car vs Tree</label>
                                <label><input type="checkbox" name="Situation" value="Car vs Car">Car vs Car</label>
                                <label><input type="checkbox" name="Situation" value="Car vs Truck">Car vs Truck</label>
                                <label><input type="checkbox" name="Situation" value="Truck vs Truck">Truck vs Truck</label>
                                <label><input type="checkbox" class="toggle-input-checkbox" data-target="rcr-situation-other-input">Other</label>
                            </div>
                            <input type="text" id="rcr-situation-other-input" name="Situation Other" placeholder="Specify other situation" class="hidden-input">
                            <div style="margin-top: 1rem;">
                                <label class="inline-checkbox-label">
                                    <input type="checkbox" id="heavy-vehicle-involved-checkbox"> Heavy Vehicle Involved?
                                </label>
                                <div id="heavy-vehicle-considerations" class="hidden-input">
                                    <p class="advisory-text">Consider Heavy Rescue and/or Officer</p>
                                </div>
                            </div>
                        </div>
                        <div>
                            <label>Entrapment</label>
                            <div class="checkbox-group" id="rcr-entrapment-group">
                                <label><input type="checkbox" name="Entrapment" value="No Entrapment">No Entrapment</label>
                                <label><input type="checkbox" name="Entrapment" value="1 Person Trapped">1 Person Trapped</label>
                                <label><input type="checkbox" name="Entrapment" value="Multiple persons trapped" class="toggle-input-checkbox" data-target="rcr-entrapment-multiple-input">Multiple persons trapped</label>
                            </div>
                            <input type="text" id="rcr-entrapment-multiple-input" name="Entrapment Specify" placeholder="Specify number of people trapped" class="hidden-input">
                            <div id="rcr-entrapment-advisory" class="advisory-text hidden-input">Make 2nd Alarm or Higher</div>
                        </div>
                        <div>
                            <label>Hazards</label>
                            <div class="checkbox-group">
                                <label><input type="checkbox" name="Hazards" value="Fuel Spill">Fuel Spill</label>
                                <label><input type="checkbox" name="Hazards" value="Traffic">Traffic</label>
                                <label><input type="checkbox" name="Hazards" value="Dangerous Goods">Dangerous Goods</label>
                                <label><input type="checkbox" class="toggle-input-checkbox" data-target="rcr-hazards-other-input">Other</label>
                            </div>
                            <input type="text" id="rcr-hazards-other-input" name="Hazards Other" placeholder="Specify other hazard" class="hidden-input">
                        </div>
                        <div>
                            <label>Actions Being Undertaken</label>
                            <div class="checkbox-group">
                                <label><input type="checkbox" name="Actions" value="Stabilisation">Stabilisation</label>
                                <label><input type="checkbox" name="Actions" value="Glass Management">Glass Management</label>
                                <label><input type="checkbox" name="Actions" value="Crews getting to work with hydraulic tools">Crews getting to work with hydraulic tools</label>
                                <label><input type="checkbox" name="Actions" value="Patient Care">Patient Care</label>
                                <label><input type="checkbox" name="Actions" value="Patient Removal">Patient Removal</label>
                                <label><input type="checkbox" name="Actions" value="Managing Hazards">Managing Hazards</label>
                                <label><input type="checkbox" name="Actions" value="Isolating Battery">Isolating Battery</label>
                                <label><input type="checkbox" name="Actions" value="Managing Fuel/Fluid Spill">Managing Fuel/Fluid Spill</label>
                                <label><input type="checkbox" name="Actions" value="Managing Fire Risk">Managing Fire Risk</label>
                                <label><input type="checkbox" class="toggle-input-checkbox" data-target="rcr-actions-other-input">Other</label>
                            </div>
                            <input type="text" id="rcr-actions-other-input" name="Actions Other" placeholder="Specify other action" class="hidden-input">
                        </div>
                         <div>
                            <label>Resources</label>
                            <fieldset class="sub-fieldset">
                                <legend>In Attendance</legend>
                                <div class="checkbox-group">
                                    <label><input type="checkbox" name="Resources In Attendance" value="WAPOL">WAPOL</label>
                                    <label><input type="checkbox" name="Resources In Attendance" value="SJA">SJA</label>
                                    <label><input type="checkbox" name="Resources In Attendance" value="Rescue 65">Rescue 65</label>
                                    <label><input type="checkbox" name="Resources In Attendance" value="Officer">Officer</label>
                                    <label><input type="checkbox" name="Resources In Attendance" value="Heavy Rescue">Heavy Rescue</label>
                                    <label><input type="checkbox" name="Resources In Attendance" value="Tow Truck">Tow Truck</label>
                                    <label><input type="checkbox" name="Resources In Attendance" value="Main Roads/LG">Main Roads/LG</label>
                                    <label><input type="checkbox" class="toggle-input-checkbox" data-target="rcr-res-att-other-input">Other</label>
                                </div>
                                <input type="text" id="rcr-res-att-other-input" name="RCR Resources In Attendance Other" placeholder="Specify other resource" class="hidden-input">
                            </fieldset>
                            <fieldset class="sub-fieldset">
                                <legend>Required</legend>
                                <div class="checkbox-group" id="rcr-resources-required-group">
                                    <label><input type="checkbox" name="Resources Required" value="WAPOL">WAPOL</label>
                                    <label><input type="checkbox" name="Resources Required" value="SJA">SJA</label>
                                    <label><input type="checkbox" name="Resources Required" value="Rescue 65">Rescue 65</label>
                                    <label><input type="checkbox" name="Resources Required" value="Officer">Officer</label>
                                    <label><input type="checkbox" name="Resources Required" value="Heavy Rescue">Heavy Rescue</label>
                                    <label><input type="checkbox" name="Resources Required" value="Tow Truck">Tow Truck</label>
                                    <label><input type="checkbox" name="Resources Required" value="Main Roads/LG">Main Roads/LG</label>
                                    <label><input type="checkbox" class="toggle-input-checkbox" data-target="rcr-res-req-other-input">Other</label>
                                </div>
                                <input type="text" id="rcr-res-req-other-input" name="RCR Resources Required Other" placeholder="Specify other resource" class="hidden-input">
                            </fieldset>
                        </div>
                        <div><label for="rcr-time">Estimated Time on Scene</label><input type="text" id="rcr-time" name="Estimated Time"></div>
                    </div>
                </fieldset>
                <fieldset>
                    <legend>Report Author</legend>
                    <div class="form-stack">
                         <label for="rcr-report-completed-by">Report Completed By</label>
                         <input type="text" id="rcr-report-completed-by" name="Report Completed By">
                         <div class="radio-group" id="rcr-author-role-selector" style="grid-template-columns: 1fr;">
                            <label><input type="radio" name="ReportAuthorRole" value="is_ic"> I am the IC</label>
                            <label><input type="radio" name="ReportAuthorRole" value="on_behalf" checked> Completed on behalf of IC</label>
                         </div>
                         <div id="rcr-ic-author-group" class="form-stack">
                             <label for="rcr-incident-controller-author">Incident Controller</label>
                             <input type="text" id="rcr-incident-controller-author" name="Incident Controller">
                         </div>
                    </div>
                </fieldset>
            </form>
            
            <!-- Hazmat Checklist Form -->
            <form id="hazmat-form" class="checklist-form">
                <fieldset>
                    <legend>Arrival & Classification</legend>
                    <div class="form-stack">
                        <div>
                            <label>Arrival Code (on arrival)</label>
                            <div class="button-group arrival-buttons">
                                <input type="hidden" name="Arrival Code" id="hm-arrival-code">
                                <button type="button" class="option-button btn-green" data-value="4 4" data-description="Nothing found, investigating, back up normal road.">4 4<span class="desc">Nothing found...</span></button>
                                <button type="button" class="option-button btn-yellow" data-value="6 6" data-description="As reported, incoming resources sufficient.">6 6<span class="desc">As reported...</span></button>
                                <button type="button" class="option-button btn-red" data-value="8 8" data-description="Incident rapidly escalating, Upgrade response 3rd alarm or higher.">8 8<span class="desc">Escalating...</span></button>
                            </div>
                            <div class="advisory-text hidden-input" id="hm-arrival-desc"></div>
                        </div>

                        <div class="call-button-container">
                            <a href="tel:1800198140" class="call-button">Call Comcen - 1800 198 140</a>
                        </div>

                        <div>
                            <label>Classification (within 5 minutes of arrival)</label>
                            <div class="button-group classification-buttons">
                                <input type="hidden" name="Classification" id="hm-classification">
                                <button type="button" class="option-button btn-green" data-value="1st Alarm">1st Alarm</button>
                                <button type="button" class="option-button btn-yellow" data-value="2nd Alarm">2nd Alarm</button>
                                <button type="button" class="option-button btn-orange" data-value="3rd Alarm">3rd Alarm</button>
                                <button type="button" class="option-button btn-darkorange" data-value="4th Alarm">4th Alarm</button>
                                <button type="button" class="option-button btn-red" data-value="5th Alarm">5th Alarm</button>
                            </div>
                            <p class="classification-note">1 Alarm = 1 FRS Appliance (3.4U, HSR, CP), BA operations require 2nd Alarm or Higher.</p>
                        </div>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>Considerations</legend>
                    <div class="checkbox-group">
                        <label><input type="checkbox" name="Considerations" value="Crew Safety">Crew Safety</label>
                        <label><input type="checkbox" name="Considerations" value="PPE">PPE</label>
                        <label><input type="checkbox" name="Considerations" value="Site Layout">Site Layout</label>
                        <label><input type="checkbox" name="Considerations" value="Specialist Advice">Specialist Advice</label>
                        <label><input type="checkbox" name="Considerations" value="Public Exposure">Public Exposure</label>
                        <label><input type="checkbox" name="Considerations" value="Decontamination">Decontamination</label>
                        <label><input type="checkbox" name="Considerations" value="Atmospheric Monitoring">Atmospheric Monitoring</label>
                        <label><input type="checkbox" name="Considerations" value="Rescue">Rescue</label>
                    </div>
                    <div style="margin-top: 1rem;">
                        <label for="hazmat-considerations-other">Other Considerations</label>
                        <input type="text" id="hazmat-considerations-other" name="Considerations Other" placeholder="Other...">
                    </div>
                </fieldset>

                <fieldset>
                    <legend>1. ARRIVAL</legend>
                    <div class="hazmat-checklist-item">
                        <label><input type="checkbox" name="hazmat-arrival-1"> Approach from upwind/uphill</label>
                        <input type="text" name="hazmat-arrival-1-notes" placeholder="Notes...">
                    </div>
                    <div class="hazmat-checklist-item">
                        <label><input type="checkbox" name="hazmat-arrival-2"> Minimum of 70 m from incident</label>
                        <input type="text" name="hazmat-arrival-2-notes" placeholder="Notes...">
                    </div>
                    <div class="hazmat-checklist-item">
                        <label><input type="checkbox" name="hazmat-arrival-3"> DO NOT enter smoke, gas or vapour cloud</label>
                        <input type="text" name="hazmat-arrival-3-notes" placeholder="Notes...">
                    </div>
                </fieldset>

                <fieldset>
                    <legend>2. PRODUCT IDENTIFICATION & IMMEDIATE ACTION</legend>
                    <div class="hazmat-checklist-item">
                        <label><input type="checkbox" name="hazmat-prod-id-1"> Assess the scene and secure the area</label>
                        <input type="text" name="hazmat-prod-id-1-notes" placeholder="Notes...">
                    </div>
                    <div class="hazmat-checklist-item">
                        <label><input type="checkbox" name="hazmat-prod-id-2"> Effect a snatch rescue if it is safe to do so</label>
                        <input type="text" name="hazmat-prod-id-2-notes" placeholder="Notes...">
                    </div>
                    <div class="hazmat-checklist-item">
                        <label><input type="checkbox" name="hazmat-prod-id-3"> Consider evacuation or shelter in place</label>
                        <input type="text" name="hazmat-prod-id-3-notes" placeholder="Notes...">
                    </div>
                    <div class="hazmat-checklist-item">
                        <label><input type="checkbox" name="hazmat-prod-id-4"> Establish communications with ComCen</label>
                        <input type="text" name="hazmat-prod-id-4-notes" placeholder="Notes...">
                    </div>
                    <div class="hazmat-checklist-item">
                        <label><input type="checkbox" name="hazmat-prod-id-5"> Establish minimum decontamination process</label>
                        <input type="text" name="hazmat-prod-id-5-notes" placeholder="Notes...">
                    </div>
                    <div class="hazmat-checklist-item">
                        <label><input type="checkbox" name="hazmat-prod-id-6"> Determine PPE for initial identification of substance</label>
                        <input type="text" name="hazmat-prod-id-6-notes" placeholder="Notes...">
                    </div>
                    <div class="hazmat-checklist-item">
                        <label><input type="checkbox" name="hazmat-prod-id-7"> Identify substance</label>
                        <input type="text" name="hazmat-prod-id-7-notes" placeholder="Notes...">
                    </div>
                    <div class="hazmat-checklist-item">
                        <label><input type="checkbox" name="hazmat-prod-id-8"> Record details on HIB</label>
                        <input type="text" name="hazmat-prod-id-8-notes" placeholder="Notes...">
                    </div>
                    <div class="hazmat-checklist-item">
                        <label><input type="checkbox" name="hazmat-prod-id-9"> Use detection equipment to assist/confirm presence of hazardous material</label>
                        <input type="text" name="hazmat-prod-id-9-notes" placeholder="Notes...">
                    </div>
                    <div class="hazmat-checklist-item">
                        <label><input type="checkbox" name="hazmat-prod-id-10"> Complete information on the HAG</label>
                        <input type="text" name="hazmat-prod-id-10-notes" placeholder="Notes...">
                    </div>
                    <div class="hazmat-checklist-item">
                        <label><input type="checkbox" name="hazmat-prod-id-11"> Transmit information from side one of the HAG to ComCen</label>
                        <input type="text" name="hazmat-prod-id-11-notes" placeholder="Notes...">
                    </div>
                    <div class="hazmat-checklist-item">
                        <label><input type="checkbox" name="hazmat-prod-id-12"> Receive information from ComCen and complete side two of the HAG</label>
                        <input type="text" name="hazmat-prod-id-12-notes" placeholder="Notes...">
                    </div>
                    <div class="hazmat-checklist-item">
                        <label><input type="checkbox" name="hazmat-prod-id-13"> Effect rescue/s when safe to do so</label>
                        <input type="text" name="hazmat-prod-id-13-notes" placeholder="Notes...">
                    </div>
                </fieldset>

                <fieldset>
                    <legend>3. FIRST STRIKE ACTION</legend>
                    <div class="hazmat-checklist-item">
                        <label><input type="checkbox" name="hazmat-strike-1"> Establish Hot, Warm and Cold zones (see Hazmat Site Layout)</label>
                        <input type="text" name="hazmat-strike-1-notes" placeholder="Notes...">
                    </div>
                    <div class="hazmat-checklist-item">
                        <label><input type="checkbox" name="hazmat-strike-2"> Establish IMT</label>
                        <input type="text" name="hazmat-strike-2-notes" placeholder="Notes...">
                    </div>
                    <div class="hazmat-checklist-item">
                        <label><input type="checkbox" name="hazmat-strike-3"> Re-assess decontamination process</label>
                        <input type="text" name="hazmat-strike-3-notes" placeholder="Notes...">
                    </div>
                    <div class="hazmat-checklist-item">
                        <label><input type="checkbox" name="hazmat-strike-4"> Re-assess PPE</label>
                        <input type="text" name="hazmat-strike-4-notes" placeholder="Notes...">
                    </div>
                    <div class="hazmat-checklist-item">
                        <label><input type="checkbox" name="hazmat-strike-5"> Initiate corrective action based on the HAG</label>
                        <input type="text" name="hazmat-strike-5-notes" placeholder="Notes...">
                    </div>
                    <div class="hazmat-checklist-item">
                        <label><input type="checkbox" name="hazmat-strike-6"> Obtain resources to render the incident safe</label>
                        <input type="text" name="hazmat-strike-6-notes" placeholder="Notes...">
                    </div>
                    <div class="hazmat-checklist-item">
                        <label><input type="checkbox" name="hazmat-strike-7"> Maintain close liaison with the FLO/HEAT</label>
                        <input type="text" name="hazmat-strike-7-notes" placeholder="Notes...">
                    </div>
                    <div class="hazmat-checklist-item">
                        <label><input type="checkbox" name="hazmat-strike-8"> Consult with Main Roads regarding road closures</label>
                        <input type="text" name="hazmat-strike-8-notes" placeholder="Notes...">
                    </div>
                    <div class="hazmat-checklist-item">
                        <label><input type="checkbox" name="hazmat-strike-9"> Consider Department of Water and Environmental Regulation Pollution Response involvement</label>
                        <input type="text" name="hazmat-strike-9-notes" placeholder="Notes...">
                    </div>
                </fieldset>

                <fieldset>
                    <legend>4. RECOVERY</legend>
                    <div class="hazmat-checklist-item">
                        <label><input type="checkbox" name="hazmat-recovery-1"> Recover the substance, based on advice from the FLO or the HEAT</label>
                        <input type="text" name="hazmat-recovery-1-notes" placeholder="Notes...">
                    </div>
                    <div class="hazmat-checklist-item">
                        <label><input type="checkbox" name="hazmat-recovery-2"> Liaise and arrange for disposal of recovered material</label>
                        <input type="text" name="hazmat-recovery-2-notes" placeholder="Notes...">
                    </div>
                </fieldset>

                <fieldset>
                    <legend>5. DECONTAMINATION</legend>
                    <div class="hazmat-checklist-item">
                        <label><input type="checkbox" name="hazmat-decon-1"> Full decontamination procedures are to be followed unless otherwise specified by the FLO of the HEAT</label>
                        <input type="text" name="hazmat-decon-1-notes" placeholder="Notes...">
                    </div>
                    <div class="hazmat-checklist-item">
                        <label><input type="checkbox" name="hazmat-decon-2"> Seek advice regarding the disposal of decontamination water and the cleaning of equipment</label>
                        <input type="text" name="hazmat-decon-2-notes" placeholder="Notes...">
                    </div>
                </fieldset>
                
                <fieldset>
                    <legend>Protecting The Public</legend>
                    <div class="form-stack">
                        <div>
                            <label><input type="checkbox" name="Public Protection" value="Shelter In Place"> Shelter In Place</label>
                            <div class="public-protection-definition">
                                <p><strong>Definition.</strong> The public in the downwind zone are immediately directed into a building or advised to remain indoors, close all windows and doors, and to turn off air-conditioners until the danger passes. This is a very simple operation which does not require many resources.</p>
                                <p style="margin-top: 0.5rem;"><strong>Application.</strong> Shelter in place if or when: There is not enough time to evacuate before the hazard affects the area. The incident or the hazard is likely to be of a short duration. Approximately not more than 1 to 2 hours.</p>
                            </div>
                        </div>
                         <div>
                            <label><input type="checkbox" name="Public Protection" value="Evacuation"> Evacuation</label>
                            <div class="public-protection-definition">
                                <p><strong>Definition.</strong> The public are moved from the threatened area to a safer place only when there is enough time to execute this strategy. The public must be warned beforehand to prepare to leave the area.</p>
                                <p style="margin-top: 0.5rem;"><strong>Application.</strong> Evacuate when: The fumes or vapours present a risk of explosion. It takes a long time for the area to be clear of fumes. The buildings cannot be sufficiently sealed.</p>
                            </div>
                        </div>
                        <div>
                            <label for="hazmat-public-protection-notes">Notes</label>
                            <textarea id="hazmat-public-protection-notes" name="Public Protection Notes" rows="3"></textarea>
                        </div>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>Public Information</legend>
                    <div class="form-stack">
                        <div>
                            <label>Warning Level</label>
                            <div class="button-group warning-buttons">
                                <input type="hidden" name="Warning Level" id="hazmat-warning-level">
                                <button type="button" class="option-button btn-blue" data-value="No Warning Required">No Warning Required</button>
                                <button type="button" class="option-button btn-yellow" data-value="Hazmat Warning">Hazmat Warning</button>
                            </div>
                        </div>
                        <div>
                            <label for="hazmat-impact-area">Smoke/Plume/Impact Area</label>
                            <input type="text" id="hazmat-impact-area" name="Smoke/Plume/Impact Area" placeholder="Describe the affected area...">
                        </div>
                        <div>
                            <label for="hazmat-community-impact">Risk to the Community</label>
                            <textarea id="hazmat-community-impact" name="Community Impact" rows="3" placeholder="e.g., Smoke affecting nearby suburbs, road closures..."></textarea>
                        </div>
                    </div>
                </fieldset>
                <fieldset>
                    <legend>Report Author</legend>
                    <div class="form-stack">
                         <label for="hm-report-completed-by">Report Completed By</label>
                         <input type="text" id="hm-report-completed-by" name="Report Completed By">
                         <div class="radio-group" id="hm-author-role-selector" style="grid-template-columns: 1fr;">
                            <label><input type="radio" name="ReportAuthorRole" value="is_ic"> I am the IC</label>
                            <label><input type="radio" name="ReportAuthorRole" value="on_behalf" checked> Completed on behalf of IC</label>
                         </div>
                         <div id="hm-ic-author-group" class="form-stack">
                             <label for="hm-incident-controller-author">Incident Controller</label>
                             <input type="text" id="hm-incident-controller-author" name="Incident Controller">
                         </div>
                    </div>
                </fieldset>
            </form>

            <!-- Ongoing Bushfire Form -->
            <form id="ongoing-bushfire-form" class="checklist-form">
                <fieldset>
                    <legend>Incident Status & Details</legend>
                    <div class="form-stack">
                        <input type="text" id="ob-incident-name" name="Incident Name" placeholder="Auto-generated Incident Name" readonly>
                        <label class="inline-checkbox-label">
                            <input type="checkbox" id="ob-name-manually-checkbox" class="name-manually-checkbox"> Name Manually
                        </label>
                        <div>
                            <label for="ob-incident-status">Incident status</label>
                            <select id="ob-incident-status" name="Incident Status">
                                <option>Going</option>
                                <option>Contained and Not yet Controlled</option>
                                <option>Contained and Controlled</option>
                                <option>Safe</option>
                            </select>
                        </div>
                        <div>
                            <label for="ob-incident-level">Incident Level</label>
                            <select id="ob-incident-level" name="Incident Level">
                                <option>Level 1</option>
                                <option>Level 2</option>
                                <option>Level 3</option>
                            </select>
                        </div>
                        <div>
                            <label for="ob-managed-under">Incident is being managed under</label>
                            <select id="ob-managed-under" name="Managed Under">
                                <option>Bushfire Act 1954</option>
                                <option>Fire Brigade Act 1942</option>
                            </select>
                        </div>
                        <div>
                            <label>Controlling Agency</label>
                            <div class="checkbox-group" id="ob-controlling-agency-group">
                                <label><input type="checkbox" name="Controlling Agency" value="DFES">DFES</label>
                                <label><input type="checkbox" name="Controlling Agency" value="DBCA">DBCA</label>
                                <div class="lga-input-group">
                                    <label class="inline-checkbox-label"><input type="checkbox" id="ob-lga-checkbox" name="Controlling Agency" value="LGA">LGA</label>
                                    <input type="text" id="ob-lga-name" name="LGA Name" class="hidden-input" placeholder="Enter LGA Name">
                                </div>
                            </div>
                        </div>
                        <input type="text" id="ob-command-channel" name="Command Channel" placeholder="Command Channel">
                        <div>
                            <label for="ob-control-point">Control Point</label>
                            <div class="location-input-group">
                                <input type="text" id="ob-control-point" name="Control Point" placeholder="Control Point" readonly>
                                <button type="button" id="ob-cp-location-btn" class="location-btn" style="padding: 0.5rem;">My Location</button>
                                <div class="full-width-item">
                                    <label class="inline-checkbox-label">
                                        <input type="checkbox" id="ob-cp-manual-checkbox" class="cp-manual-checkbox"> Enter Manually
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div>
                            <label for="ob-fire-size">Fire Size (ha)</label>
                            <input type="number" id="ob-fire-size" name="Fire Size (ha)">
                        </div>
                        <div id="ob-time-contained-wrapper">
                            <label for="ob-time-contained" id="ob-time-contained-label">Estimated time until contained</label>
                            <input type="text" id="ob-time-contained" name="Estimated time until contained">
                        </div>
                        <input type="text" id="ob-time-safe" name="Estimated time until safe" placeholder="Estimated time until safe">
                    </div>
                </fieldset>

                <fieldset>
                    <legend>Current IMT structure</legend>
                    <div class="imt-grid">
                        <input type="text" name="IMT IC" placeholder="IC (Rank Surname)">
                        <input type="text" name="IMT OO" placeholder="OO (Rank Surname)">
                        <input type="text" name="IMT PO" placeholder="PO (Rank Surname)">
                        <input type="text" name="IMT LO" placeholder="LO (Rank Surname)">
                        <input type="text" name="IMT PIO" placeholder="PIO (Rank Surname)">
                    </div>
                </fieldset>

                <fieldset>
                    <legend>Objectives</legend>
                    <div class="objective-grid">
                        <label for="ob-obj-1">Obj 1</label>
                        <input type="text" id="ob-obj-1" name="Objective 1">
                        <select name="Objective 1 Status"><option>On Target</option><option>Below Target</option><option>Above Target</option></select>
                        
                        <label for="ob-obj-2">Obj 2</label>
                        <input type="text" id="ob-obj-2" name="Objective 2">
                        <select name="Objective 2 Status"><option>On Target</option><option>Below Target</option><option>Above Target</option></select>

                        <label for="ob-obj-3">Obj 3</label>
                        <input type="text" id="ob-obj-3" name="Objective 3">
                        <select name="Objective 3 Status"><option>On Target</option><option>Below Target</option><option>Above Target</option></select>

                        <label for="ob-obj-4">Obj 4</label>
                        <input type="text" id="ob-obj-4" name="Objective 4">
                        <select name="Objective 4 Status"><option>On Target</option><option>Below Target</option><option>Above Target</option></select>

                        <label for="ob-obj-5">Obj 5</label>
                        <input type="text" id="ob-obj-5" name="Objective 5">
                        <select name="Objective 5 Status"><option>On Target</option><option>Below Target</option><option>Above Target</option></select>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>Strategies</legend>
                    <div class="form-stack">
                        <select name="Strategies">
                            <option>Offensive</option>
                            <option>Defensive</option>
                        </select>
                        <label class="inline-checkbox-label">
                            <input type="checkbox" class="toggle-input-checkbox" data-target="ob-strategies-other"> Other
                        </label>
                        <input type="text" id="ob-strategies-other" name="Strategies Other" class="hidden-input" placeholder="Specify other strategy">
                    </div>
                </fieldset>

                <fieldset>
                    <legend>Community Warnings</legend>
                    <!-- Warning 1 -->
                    <div id="ob-warning-1-container">
                        <div class="form-stack">
                            <div>
                                <label>Warning Level</label>
                                <div class="button-group warning-buttons" data-warning-id="ob-1">
                                    <input type="hidden" name="Warning Level 1" id="ob-warning-level-1">
                                    <button type="button" class="option-button btn-blue" data-value="No Warning Required">No Warning Required</button>
                                    <button type="button" class="option-button btn-yellow" data-value="Advice">Advice</button>
                                    <button type="button" class="option-button btn-orange" data-value="Watch and Act">Watch and Act</button>
                                    <button type="button" class="option-button btn-red" data-value="Emergency Warning">Emergency Warning</button>
                                </div>
                            </div>
                            <div>
                                <label for="ob-action-statement-1">Action Statement</label>
                                <select name="Action Statement 1" id="ob-action-statement-1"></select>
                            </div>
                            <div>
                                <label>Warning Boundaries</label>
                                <div class="form-stack" style="margin-top: 0.5rem;">
                                    <input type="text" name="Northern Boundary 1" placeholder="Northern Boundary">
                                    <input type="text" name="Eastern Boundary 1" placeholder="Eastern Boundary">
                                    <input type="text" name="Southern Boundary 1" placeholder="Southern Boundary">
                                    <input type="text" name="Western Boundary 1" placeholder="Western Boundary">
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Warning 2 -->
                    <div id="ob-warning-2-container" class="multiple-warning-container hidden-section">
                        <legend>Warning Area 2</legend>
                        <div class="form-stack">
                            <div>
                                <label>Warning Level</label>
                                <div class="button-group warning-buttons" data-warning-id="ob-2">
                                    <input type="hidden" name="Warning Level 2" id="ob-warning-level-2">
                                    <button type="button" class="option-button btn-blue" data-value="No Warning Required">No Warning Required</button>
                                    <button type="button" class="option-button btn-yellow" data-value="Advice">Advice</button>
                                    <button type="button" class="option-button btn-orange" data-value="Watch and Act">Watch and Act</button>
                                    <button type="button" class="option-button btn-red" data-value="Emergency Warning">Emergency Warning</button>
                                </div>
                            </div>
                            <div>
                                <label for="ob-action-statement-2">Action Statement</label>
                                <select name="Action Statement 2" id="ob-action-statement-2"></select>
                            </div>
                            <div>
                                <label>Warning Boundaries</label>
                                <div class="form-stack" style="margin-top: 0.5rem;">
                                    <input type="text" name="Northern Boundary 2" placeholder="Northern Boundary">
                                    <input type="text" name="Eastern Boundary 2" placeholder="Eastern Boundary">
                                    <input type="text" name="Southern Boundary 2" placeholder="Southern Boundary">
                                    <input type="text" name="Western Boundary 2" placeholder="Western Boundary">
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Warning 3 -->
                     <div id="ob-warning-3-container" class="multiple-warning-container hidden-section">
                        <legend>Warning Area 3</legend>
                        <div class="form-stack">
                            <div>
                                <label>Warning Level</label>
                                <div class="button-group warning-buttons" data-warning-id="ob-3">
                                    <input type="hidden" name="Warning Level 3" id="ob-warning-level-3">
                                    <button type="button" class="option-button btn-blue" data-value="No Warning Required">No Warning Required</button>
                                    <button type="button" class="option-button btn-yellow" data-value="Advice">Advice</button>
                                    <button type="button" class="option-button btn-orange" data-value="Watch and Act">Watch and Act</button>
                                    <button type="button" class="option-button btn-red" data-value="Emergency Warning">Emergency Warning</button>
                                </div>
                            </div>
                            <div>
                                <label for="ob-action-statement-3">Action Statement</label>
                                <select name="Action Statement 3" id="ob-action-statement-3"></select>
                            </div>
                            <div>
                                <label>Warning Boundaries</label>
                                <div class="form-stack" style="margin-top: 0.5rem;">
                                    <input type="text" name="Northern Boundary 3" placeholder="Northern Boundary">
                                    <input type="text" name="Eastern Boundary 3" placeholder="Eastern Boundary">
                                    <input type="text" name="Southern Boundary 3" placeholder="Southern Boundary">
                                    <input type="text" name="Western Boundary 3" placeholder="Western Boundary">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 1.5rem;">
                        <label class="inline-checkbox-label" id="ob-add-warning-2-label">
                            <input type="checkbox" id="ob-add-warning-2-checkbox"> Add a second Warning Area
                        </label>
                         <label class="inline-checkbox-label hidden-section" id="ob-add-warning-3-label">
                            <input type="checkbox" id="ob-add-warning-3-checkbox"> Add a third Warning Area
                        </label>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>Risks & Support</legend>
                    <div class="form-stack">
                        <div>
                            <label for="ob-risks">Key Identified Risks</label>
                            <textarea id="ob-risks" name="Key Identified Risks" rows="4"></textarea>
                        </div>
                        <div>
                            <label>Support agencies on site</label>
                            <div class="checkbox-group">
                                <label><input type="checkbox" name="Support Agencies" value="WAPol">WAPol</label>
                                <label><input type="checkbox" name="Support Agencies" value="Local Government">Local Government</label>
                                <label><input type="checkbox" name="Support Agencies" value="MainRoads">MainRoads</label>
                                <label><input type="checkbox" name="Support Agencies" value="Salvation Army">Salvation Army</label>
                                <label><input type="checkbox" class="toggle-input-checkbox" data-target="ob-support-other">Other</label>
                            </div>
                            <input type="text" id="ob-support-other" name="Support Agencies Other" class="hidden-input" placeholder="Specify other agency">
                        </div>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>Forward Planning</legend>
                    <div class="form-stack">
                        <div>
                            <label>Relief management</label>
                            <div class="radio-group">
                                <label><input type="radio" name="Relief Management" value="Self Managed">Self Managed</label>
                                <label><input type="radio" name="Relief Management" value="Required" class="toggle-input-checkbox" data-target="ob-relief-required">Required</label>
                            </div>
                            <textarea id="ob-relief-required" name="Relief Required Details" class="hidden-input" placeholder="Details for relief required..." rows="2"></textarea>
                        </div>
                        <div>
                            <label>Further Update</label>
                            <div class="radio-group">
                                <label><input type="radio" name="Further Update" value="1 hour">1 hour</label>
                                <label><input type="radio" name="Further Update" value="3 hours">3 hours</label>
                                <label><input type="radio" name="Further Update" value="8 hours">8 hours</label>
                            </div>
                        </div>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>Incident Support Group</legend>
                     <div>
                        <label>ISG updates</label>
                        <div class="radio-group" id="ob-isg-group">
                            <label><input type="radio" name="ISG Update" value="Scheduled">ISG Scheduled</label>
                            <label><input type="radio" name="ISG Update" value="Not Required">ISG not required</label>
                            <label><input type="radio" name="ISG Update" value="Planned">ISG planned</label>
                        </div>
                        <input type="text" id="ob-isg-scheduled-details" name="ISG Scheduled Details" class="hidden-input" placeholder="Time/Details for scheduled ISG...">
                        <input type="text" id="ob-isg-planned-details" name="ISG Planned Details" class="hidden-input" placeholder="Time/Details for planned ISG...">
                    </div>
                </fieldset>

                <fieldset>
                    <legend>Report Author</legend>
                    <div class="form-stack">
                         <label for="ob-report-by">Report by</label>
                         <input type="text" id="ob-report-by" name="Report by">
                    </div>
                </fieldset>
            </form>

            <p class="sitrep-instruction">Complete a SitRep whenever the situation changes, change in incident progression or escalation or significant event happens</p>

            <section class="action-buttons">
                <button id="generate-report-btn" class="action-button">Generate Report</button>
                <button id="email-report-btn" class="action-button dispatch-btn" disabled>Email Report to Comcen</button>
                <button id="sms-report-btn" class="action-button dispatch-btn" disabled>SMS Report</button>
                <button id="copy-report-btn" class="action-button dispatch-btn" disabled>Copy Report</button>
                <p class="action-note">If emailing report to Comcen, must follow up with a phone call</p>
            </section>

            <div id="report-output-container" style="display: none;">
                <h3>Generated Report</h3>
                <pre id="report-output"></pre>
            </div>
        </main>
        <footer>
            <p>Created by Ben Davies</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const globalIncidentSelector = document.getElementById('global-incident-selector');
            const manualIncidentNumber = document.getElementById('manual-incident-number');
            const manualIncidentType = document.getElementById('manual-incident-type');
            const manualLocation = document.getElementById('manual-location');
            const checklistSelector = document.getElementById('checklist-type-selector');
            const forms = document.querySelectorAll('.checklist-form');
            const generateBtn = document.getElementById('generate-report-btn');
            const copyBtn = document.getElementById('copy-report-btn');
            const emailBtn = document.getElementById('email-report-btn');
            const smsBtn = document.getElementById('sms-report-btn');
            const reportOutputContainer = document.getElementById('report-output-container');
            const reportOutput = document.getElementById('report-output');
            const lastUpdatedEl = document.getElementById('last-updated-time');

            let generatedReportText = '';
            const RSS_URL = 'https://api.allorigins.win/raw?url=https://api.emergency.wa.gov.au/v1/rss/incidents';

            const actionStatementsMap = {
                'Advice': ['PREPARE NOW', 'STAY INFORMED', 'MONITOR CONDITIONS'],
                'Watch and Act': ['PREPARE TO LEAVE', 'LEAVE NOW IF NOT PREPARED', 'BE AWARE OF EMBER ATTACK', 'MONITOR CONDITIONS'],
                'Emergency Warning': ['LEAVE NOW', 'TOO LATE TO LEAVE'],
                'No Warning Required': [],
                '': []
            };

            const compassMap = {
                'N': 'North', 'NE': 'North East', 'E': 'East', 'SE': 'South East',
                'S': 'South', 'SW': 'South West', 'W': 'West', 'NW': 'North West'
            };

            // --- Geolocation ---
            async function reverseGeocode(lat, lon, addressEl) {
                addressEl.value = 'Fetching address...';
                try {
                    const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
                    if (!response.ok) throw new Error('Reverse geocoding failed');
                    const data = await response.json();
                    addressEl.value = data.display_name || 'Address not found';
                } catch (error) {
                    console.error('Reverse Geocoding Error:', error);
                    addressEl.value = 'Could not fetch address';
                }
            }

            function getLocation(latEl, addressEl) {
                if (!navigator.geolocation) {
                    alert('Geolocation is not supported by your browser.');
                    return;
                }
                function success(position) {
                    const latitude = position.coords.latitude;
                    const longitude = position.coords.longitude;
                    latEl.value = `${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;
                    if (addressEl) {
                        reverseGeocode(latitude, longitude, addressEl);
                    }
                }
                function error() { alert('Unable to retrieve your location.'); }
                latEl.value = 'Getting location...';
                if (addressEl) addressEl.value = '';
                navigator.geolocation.getCurrentPosition(success, error);
            }
            
            function getCoordsForInput(targetInput) {
                if (!navigator.geolocation) {
                    alert('Geolocation is not supported by your browser.');
                    return;
                }
                targetInput.value = 'Getting location...';
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const { latitude, longitude } = position.coords;
                        targetInput.value = `${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;
                    },
                    () => {
                        targetInput.value = 'Unable to retrieve location.';
                    }
                );
            }

            document.getElementById('bf-get-location-btn').addEventListener('click', () => getLocation(document.getElementById('bf-lat-long'), document.getElementById('bf-street-address')));
            document.getElementById('sf-get-location-btn').addEventListener('click', () => getLocation(document.getElementById('sf-lat-long'), document.getElementById('sf-street-address')));
            document.getElementById('rcr-get-location-btn').addEventListener('click', () => getLocation(document.getElementById('rcr-lat-long'), document.getElementById('rcr-street-address')));
            
            // --- Core Application Logic ---
            function toTitleCase(str) {
                if (!str) return '';
                return str.toLowerCase().split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
            }

            async function fetchAndPopulateIncidents() {
                try {
                    const response = await fetch(RSS_URL);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    
                    const xmlString = await response.text();
                    const parser = new DOMParser();
                    const xmlDoc = parser.parseFromString(xmlString, "application/xml");
                    
                    const items = xmlDoc.querySelectorAll("item");
                    const sortedItems = Array.from(items).sort((a, b) => {
                        const dateA = new Date(a.querySelector("pubDate")?.textContent || 0);
                        const dateB = new Date(b.querySelector("pubDate")?.textContent || 0);
                        return dateB - dateA;
                    });

                    const currentVal = globalIncidentSelector.value;
                    globalIncidentSelector.innerHTML = '<option value="">Select an incident...</option>';
                    sortedItems.forEach(item => {
                        const title = item.querySelector("title")?.textContent;
                        if (!title || title.toLowerCase().includes('burn off')) return;
                        const option = document.createElement('option');
                        option.value = title;
                        option.textContent = title;
                        globalIncidentSelector.appendChild(option);
                    });
                    globalIncidentSelector.value = currentVal;
                    
                    lastUpdatedEl.textContent = new Date().toLocaleTimeString();

                } catch (error) {
                    console.error("Failed to fetch or parse RSS feed:", error);
                    lastUpdatedEl.textContent = `Error at ${new Date().toLocaleTimeString()}`;
                    globalIncidentSelector.innerHTML = '<option value="">Could not load incidents</option>';
                }
            }

            function updateActionStatementDropdown(warningLevel, dropdownElement) {
                dropdownElement.innerHTML = '';
                const statements = actionStatementsMap[warningLevel] || [];
                if (statements.length === 0) {
                    dropdownElement.style.display = 'none';
                    if(dropdownElement.previousElementSibling) dropdownElement.previousElementSibling.style.display = 'none';
                } else {
                    dropdownElement.style.display = 'block';
                    if(dropdownElement.previousElementSibling) dropdownElement.previousElementSibling.style.display = 'block';
                    statements.forEach(stmt => {
                        const option = document.createElement('option');
                        option.value = stmt;
                        option.textContent = stmt;
                        dropdownElement.appendChild(option);
                    });
                }
            }

            function initializeAuthorSection(prefix) {
                const completedByInput = document.getElementById(`${prefix}-report-completed-by`);
                const icAuthorGroup = document.getElementById(`${prefix}-ic-author-group`);
                const icAuthorInput = document.getElementById(`${prefix}-incident-controller-author`);
                const roleSelector = document.getElementById(`${prefix}-author-role-selector`);
                const mainIcInput = document.getElementById(`${prefix}-incident-controller`) || document.getElementById('sf-incident-controller');

                if (!completedByInput || !roleSelector) return;

                const handleRoleChange = () => {
                    const isBehalf = roleSelector.querySelector('input[value="on_behalf"]').checked;
                    if (icAuthorGroup) icAuthorGroup.classList.toggle('hidden-input', !isBehalf);
                    
                    if (mainIcInput && prefix !== 'ob') { // Exclude ongoing bushfire from this specific logic
                        if (isBehalf) {
                            mainIcInput.readOnly = false;
                            if (icAuthorInput) icAuthorInput.value = mainIcInput.value;
                        } else { // Is the IC
                            mainIcInput.value = completedByInput.value;
                            mainIcInput.readOnly = true;
                            if (icAuthorInput) icAuthorInput.value = '';
                        }
                    }
                };

                roleSelector.addEventListener('change', handleRoleChange);
                
                completedByInput.addEventListener('input', () => {
                    const isIC = roleSelector.querySelector('input[value="is_ic"]').checked;
                    if (isIC && mainIcInput) {
                        mainIcInput.value = completedByInput.value;
                    }
                });

                if (mainIcInput) {
                    mainIcInput.addEventListener('input', () => {
                        const isBehalf = roleSelector.querySelector('input[value="on_behalf"]').checked;
                        if (isBehalf && icAuthorInput) {
                            icAuthorInput.value = mainIcInput.value;
                        }
                    });
                }

                handleRoleChange(); // Initial state
            }

            function initializeControlPoint(prefix) {
                const cpInput = document.getElementById(`${prefix}-control-point`);
                const cpLocationBtn = document.getElementById(`${prefix}-cp-location-btn`);
                const cpManualCheckbox = document.getElementById(`${prefix}-cp-manual-checkbox`);

                if (!cpInput || !cpLocationBtn || !cpManualCheckbox) return;

                cpLocationBtn.addEventListener('click', () => getCoordsForInput(cpInput));

                cpManualCheckbox.addEventListener('change', (e) => {
                    const isManual = e.target.checked;
                    cpInput.readOnly = !isManual;
                    cpLocationBtn.disabled = isManual;
                    if (isManual) {
                        cpInput.value = '';
                        cpInput.focus();
                    } else {
                        cpInput.value = ''; // Clear it when switching back to auto
                    }
                });
            }

            function initializeInteractiveInputs() {
                ['bf', 'sf', 'rcr', 'hm', 'ob'].forEach(prefix => {
                    initializeAuthorSection(prefix);
                    initializeControlPoint(prefix);
                });

                document.querySelectorAll('.toggle-input-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', (e) => {
                        const targetId = e.target.dataset.target;
                        const inputEl = document.getElementById(targetId);
                        if (inputEl) {
                            inputEl.classList.toggle('hidden-input', !e.target.checked);
                            if (!e.target.checked) inputEl.value = '';
                        }
                    });
                });

                document.querySelectorAll('.quantity-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', (e) => {
                        const inputId = e.target.dataset.inputId;
                        const descId = e.target.dataset.descId;
                        const inputEl = document.getElementById(inputId);
                        const descEl = descId ? document.getElementById(descId) : null;

                        if (inputEl) {
                            inputEl.classList.toggle('hidden-input', !e.target.checked);
                            if (!e.target.checked) inputEl.value = '';
                        }
                        if (descEl) {
                            descEl.classList.toggle('hidden-input', !e.target.checked);
                            if (!e.target.checked) descEl.value = '';
                        }
                    });
                });

                const applianceStatusSelector = document.getElementById('appliance-status-selector');
                if (applianceStatusSelector) {
                    applianceStatusSelector.addEventListener('change', e => {
                        const detailsContainer = document.getElementById('resource-request-details');
                        detailsContainer.classList.toggle('hidden-input', e.target.value !== 'RequireAdditional');
                        if (e.target.value !== 'RequireAdditional') {
                            detailsContainer.querySelectorAll('input[type="number"], input[type="text"]').forEach(input => input.value = '');
                            detailsContainer.querySelectorAll('.quantity-checkbox').forEach(input => {
                                input.checked = false;
                                const qtyInput = document.getElementById(input.dataset.inputId);
                                if (qtyInput) qtyInput.classList.add('hidden-input');
                                const descInput = input.dataset.descId ? document.getElementById(input.dataset.descId) : null;
                                if (descInput) descInput.classList.add('hidden-input');
                            });
                        }
                    });
                }

                const supportStatusSelector = document.getElementById('support-status-selector');
                if (supportStatusSelector) {
                    supportStatusSelector.addEventListener('change', e => {
                        const detailsContainer = document.getElementById('support-request-details');
                        detailsContainer.classList.toggle('hidden-input', e.target.value !== 'Required');
                    });
                }

                const intelStatusSelector = document.getElementById('intel-status-selector');
                if (intelStatusSelector) {
                    intelStatusSelector.addEventListener('change', e => {
                        const detailsContainer = document.getElementById('intel-request-details');
                        detailsContainer.classList.toggle('hidden-input', e.target.value !== 'Required');
                    });
                }

                const areaUnitSelector = document.getElementById('area-unit-selector');
                if (areaUnitSelector) {
                    const haGroup = document.getElementById('area-hectares-input-group');
                    const mGroup = document.getElementById('area-metres-input-group');
                    const m1 = document.getElementById('a-area-m1');
                    const m2 = document.getElementById('a-area-m2');
                    const sqmOutput = document.getElementById('a-area-sqm');

                    areaUnitSelector.addEventListener('change', e => {
                        const useHectares = e.target.value === 'hectares';
                        haGroup.classList.toggle('hidden-input', !useHectares);
                        mGroup.classList.toggle('hidden-input', useHectares);
                    });

                    const calculateSqM = () => {
                        const val1 = parseFloat(m1.value) || 0;
                        const val2 = parseFloat(m2.value) || 0;
                        sqmOutput.value = `${(val1 * val2).toLocaleString()} m²`;
                    };

                    m1.addEventListener('input', calculateSqM);
                    m2.addEventListener('input', calculateSqM);
                }

                const managedUnderSelect = document.getElementById('bf-managed-under');
                const managedUnderOtherInput = document.getElementById('bf-managed-under-other');
                if (managedUnderSelect) {
                    managedUnderSelect.addEventListener('change', e => {
                        managedUnderOtherInput.classList.toggle('hidden-input', e.target.value !== 'Other');
                        if (e.target.value !== 'Other') {
                            managedUnderOtherInput.value = '';
                        }
                    });
                }

                document.querySelectorAll('.name-manually-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', (e) => {
                        const form = e.target.closest('form');
                        const incidentNameInput = form.querySelector('input[name="Incident Name"]');
                        if (incidentNameInput) {
                            incidentNameInput.readOnly = !e.target.checked;
                            if(e.target.checked) incidentNameInput.focus();
                            else updateIncidentName();
                        }
                    });
                });

                document.querySelectorAll('.pos-manual-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', (e) => {
                        const form = e.target.closest('form');
                        if (!form) return;
                        const latLongInput = form.querySelector('input[name="Lat/Long"]');
                        const addressInput = form.querySelector('input[name="Street Address"]');
                        const locationBtn = form.querySelector('.location-btn');
                        const isManual = e.target.checked;
                        if (latLongInput) latLongInput.readOnly = !isManual;
                        if (addressInput) addressInput.readOnly = !isManual;
                        if (locationBtn) locationBtn.disabled = isManual;
                        if (isManual && latLongInput) latLongInput.focus();
                    });
                });

                const bfLgaCheckbox = document.getElementById('bf-lga-checkbox');
                const bfLgaName = document.getElementById('bf-lga-name');
                if (bfLgaCheckbox && bfLgaName) {
                    bfLgaCheckbox.addEventListener('change', e => {
                        bfLgaName.classList.toggle('hidden-input', !e.target.checked);
                        if (!e.target.checked) bfLgaName.value = '';
                    });
                }

                const lifeInvolvementGroup = document.getElementById('life-involvement-group');
                if (lifeInvolvementGroup) {
                    const confirmedContainer = document.getElementById('persons-unaccounted-container');
                    const possibleContainer = document.getElementById('possible-persons-container');
                    lifeInvolvementGroup.addEventListener('change', (e) => {
                        confirmedContainer.classList.add('hidden-input');
                        possibleContainer.classList.add('hidden-input');
                        confirmedContainer.querySelector('input').value = '';
                        possibleContainer.querySelector('input').value = '';
                        if (e.target.value === 'Life Involvement Confirmed') {
                            confirmedContainer.classList.remove('hidden-input');
                        } else if (e.target.value === 'Life Involvement not confirmed') {
                            possibleContainer.classList.remove('hidden-input');
                        }
                    });
                }

                const sfExposuresGroup = document.getElementById('sf-exposures-group');
                if (sfExposuresGroup) {
                    const locationInput = document.getElementById('sf-exposures-location-input');
                    sfExposuresGroup.addEventListener('change', () => {
                        const isExposureChecked = sfExposuresGroup.querySelector('input[value="Exposure"]').checked;
                        const isMultipleChecked = sfExposuresGroup.querySelector('input[value="Multiple Exposures"]').checked;
                        locationInput.classList.toggle('hidden-input', !(isExposureChecked || isMultipleChecked));
                        if (!isExposureChecked && !isMultipleChecked) locationInput.value = '';
                    });
                }

                const heavyVehicleCheckbox = document.getElementById('heavy-vehicle-involved-checkbox');
                if (heavyVehicleCheckbox) {
                    heavyVehicleCheckbox.addEventListener('change', (e) => {
                        const considerationsEl = document.getElementById('heavy-vehicle-considerations');
                        const heavyRescueCheckbox = document.querySelector('#rcr-resources-required-group input[value="Heavy Rescue"]');
                        const officerCheckbox = document.querySelector('#rcr-resources-required-group input[value="Officer"]');
                        considerationsEl.classList.toggle('hidden-input', !e.target.checked);
                        if (e.target.checked) {
                            heavyRescueCheckbox.checked = true;
                            officerCheckbox.checked = true;
                        } else {
                            heavyRescueCheckbox.checked = false;
                            officerCheckbox.checked = false;
                        }
                    });
                }

                const rcrEntrapmentGroup = document.getElementById('rcr-entrapment-group');
                if (rcrEntrapmentGroup) {
                    const advisory = document.getElementById('rcr-entrapment-advisory');
                    const multipleInput = document.getElementById('rcr-entrapment-multiple-input');
                    rcrEntrapmentGroup.addEventListener('change', (e) => {
                        const oneTrapped = rcrEntrapmentGroup.querySelector('input[value="1 Person Trapped"]').checked;
                        const multipleTrapped = rcrEntrapmentGroup.querySelector('input[value="Multiple persons trapped"]').checked;
                        advisory.classList.toggle('hidden-input', !(oneTrapped || multipleTrapped));
                        if (e.target.value === "Multiple persons trapped") {
                             multipleInput.classList.toggle('hidden-input', !e.target.checked);
                             if (!e.target.checked) multipleInput.value = '';
                        }
                    });
                }

                // Multiple Warnings Logic
                ['bf', 'ob'].forEach(prefix => {
                    const addWarning2Checkbox = document.getElementById(`${prefix}-add-warning-2-checkbox`);
                    const addWarning3Checkbox = document.getElementById(`${prefix}-add-warning-3-checkbox`);
                    const warning2Container = document.getElementById(`${prefix}-warning-2-container`);
                    const warning3Container = document.getElementById(`${prefix}-warning-3-container`);
                    const addWarning3Label = document.getElementById(`${prefix}-add-warning-3-label`);
                    if(addWarning2Checkbox) {
                        addWarning2Checkbox.addEventListener('change', (e) => {
                            const show = e.target.checked;
                            warning2Container.classList.toggle('hidden-section', !show);
                            addWarning3Label.classList.toggle('hidden-section', !show);
                            if (!show) {
                                addWarning3Checkbox.checked = false;
                                warning3Container.classList.add('hidden-section');
                            }
                        });
                        addWarning3Checkbox.addEventListener('change', (e) => {
                            warning3Container.classList.toggle('hidden-section', !e.target.checked);
                        });
                    }
                });

                // Compass Logic
                const compassGrid = document.querySelector('.compass-grid');
                const directionInput = document.getElementById('bf-direction-travel');
                if (compassGrid && directionInput) {
                    compassGrid.addEventListener('change', (e) => {
                        if (e.target.type === 'checkbox') {
                            const checkedDirections = [];
                            const checkboxes = compassGrid.querySelectorAll('input[type="checkbox"]:checked');
                            checkboxes.forEach(cb => { checkedDirections.push(compassMap[cb.value]); });
                            directionInput.value = checkedDirections.join(', ');
                        }
                    });
                }

                // Ongoing Bushfire Logic
                const obManagedUnder = document.getElementById('ob-managed-under');
                const obLgaCheckbox = document.getElementById('ob-lga-checkbox');
                const obLgaName = document.getElementById('ob-lga-name');
                const obDfesCheckbox = document.querySelector('#ob-controlling-agency-group input[value="DFES"]');
                if (obManagedUnder && obLgaCheckbox && obLgaName && obDfesCheckbox) {
                    obManagedUnder.addEventListener('change', e => {
                        if (e.target.value === 'Fire Brigade Act 1942') {
                            obDfesCheckbox.checked = true;
                        }
                    });
                    obLgaCheckbox.addEventListener('change', e => {
                        obLgaName.classList.toggle('hidden-input', !e.target.checked);
                        if (!e.target.checked) obLgaName.value = '';
                    });
                }

                const obIncidentStatus = document.getElementById('ob-incident-status');
                const obTimeContainedWrapper = document.getElementById('ob-time-contained-wrapper');
                const obTimeContainedLabel = document.getElementById('ob-time-contained-label');
                if (obIncidentStatus && obTimeContainedWrapper && obTimeContainedLabel) {
                    obIncidentStatus.addEventListener('change', e => {
                        const status = e.target.value;
                        if (status === 'Contained and Controlled') {
                            obTimeContainedWrapper.style.display = 'none';
                        } else {
                            obTimeContainedWrapper.style.display = 'block';
                            if (status === 'Contained and Not yet Controlled') {
                                obTimeContainedLabel.textContent = 'Estimated time until Controlled';
                            } else {
                                obTimeContainedLabel.textContent = 'Estimated time until contained';
                            }
                        }
                    });
                }

                const isgGroup = document.getElementById('ob-isg-group');
                if (isgGroup) {
                    const scheduledDetails = document.getElementById('ob-isg-scheduled-details');
                    const plannedDetails = document.getElementById('ob-isg-planned-details');
                    isgGroup.addEventListener('change', e => {
                        scheduledDetails.classList.add('hidden-input');
                        plannedDetails.classList.add('hidden-input');
                        if (e.target.value === 'Scheduled') {
                            scheduledDetails.classList.remove('hidden-input');
                        } else if (e.target.value === 'Planned') {
                            plannedDetails.classList.remove('hidden-input');
                        }
                    });
                }
            }

            function initializeButtonGroups() {
                document.querySelectorAll('.button-group').forEach(group => {
                    const hiddenInput = group.querySelector('input[type="hidden"]');
                    const buttons = group.querySelectorAll('.option-button');
                    buttons.forEach(button => {
                        button.addEventListener('click', () => {
                            const value = button.dataset.value;
                            if (hiddenInput) hiddenInput.value = value;
                            buttons.forEach(btn => btn.classList.remove('selected'));
                            button.classList.add('selected');

                            if (group.classList.contains('arrival-buttons')) {
                                const form = group.closest('form');
                                let descElId;
                                if (form.id.startsWith('bf')) descElId = 'bf-arrival-desc';
                                else if (form.id.startsWith('sf')) descElId = 'sf-arrival-desc';
                                else if (form.id.startsWith('road-crash')) descElId = 'rcr-arrival-desc';
                                else if (form.id.startsWith('hazmat')) descElId = 'hm-arrival-desc';
                                const descEl = document.getElementById(descElId);
                                if (descEl) {
                                    descEl.textContent = button.dataset.description;
                                    descEl.style.display = 'block';
                                }
                            }

                            if (group.classList.contains('warning-buttons') && (group.closest('form').id.includes('bushfire'))) {
                                const warningId = group.dataset.warningId; // e.g., "bf-1" or "ob-1"
                                const prefix = warningId.split('-')[0];
                                const num = warningId.split('-')[1];
                                const dropdown = document.getElementById(`${prefix}-action-statement-${num}`);
                                if (dropdown) {
                                    updateActionStatementDropdown(value, dropdown);
                                }
                            }
                        });
                    });
                });
            }

            function createRequestItem(id, label, statuses, container) {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'request-item';
                
                const name = `Request-${id}`;
                
                let content = `<span class="request-item-label">${label}</span><div class="radio-group">`;
                statuses.forEach((status, index) => {
                    const value = status.replace(/\s+/g, '');
                    content += `<label><input type="radio" name="${name}" value="${value}" ${index === 0 ? 'checked' : ''}>${status}</label>`;
                });
                content += `</div>`;

                content += `
                    <div id="request-via-${id}" class="request-via-group hidden-input">
                        <fieldset>
                            <legend>Already Requested via</legend>
                            <div class="checkbox-group">
                                <label><input type="checkbox" name="${name}-via" value="Comcen">Comcen</label>
                                <label><input type="checkbox" name="${name}-via" value="RDC">RDC</label>
                                <label><input type="checkbox" name="${name}-via" value="LGA">LGA</label>
                                <div class="other-input-group">
                                    <label class="inline-checkbox-label"><input type="checkbox" class="toggle-input-checkbox" data-target="${name}-via-other-input">Other</label>
                                    <input type="text" id="${name}-via-other-input" name="${name}-via-other" class="hidden-input">
                                </div>
                            </div>
                        </fieldset>
                    </div>
                `;

                itemDiv.innerHTML = content;
                container.appendChild(itemDiv);

                const requestViaDiv = itemDiv.querySelector(`#request-via-${id}`);
                itemDiv.querySelector('.radio-group').addEventListener('change', (e) => {
                    requestViaDiv.classList.toggle('hidden-input', e.target.value !== 'AlreadybeenRequested');
                });
                
                const otherCheckbox = itemDiv.querySelector(`.toggle-input-checkbox[data-target="${name}-via-other-input"]`);
                if (otherCheckbox) {
                    otherCheckbox.addEventListener('change', (e) => {
                        const targetInput = document.getElementById(`${name}-via-other-input`);
                        targetInput.classList.toggle('hidden-input', !e.target.checked);
                        if (!e.target.checked) targetInput.value = '';
                    });
                }
            }

            function initializeBushfireRequests() {
                const resourceContainer = document.getElementById('bf-resource-requests');
                const supportContainer = document.getElementById('bf-support-requests');
                const intelContainer = document.getElementById('bf-intel-requests');
                
                const resourceItems = [
                    { id: 'AirSupport', label: 'Air Support' },
                    { id: 'AssetProtect', label: 'Asset Protection' }
                ];
                const supportItems = [
                    { id: 'DFESOfficer', label: 'DFES Officer' },
                    { id: 'IMTSupport', label: 'IMT Support' },
                    { id: 'WAPOL', label: 'WAPOL' },
                    { id: 'SJA', label: 'SJA' },
                    { id: 'MainRoads', label: 'Main Roads' },
                    { id: 'TrafficManagement', label: 'Traffic Management' },
                    { id: 'LGA', label: 'LGA' }
                ];
                const resourceAndSupportStatuses = ['Not Required', 'Require', 'Already been Requested', 'On Scene'];

                const intelItems = [
                    { id: 'Weather', label: 'Incident Weather Forecast (IWF)' },
                    { id: 'Predictions', label: 'Predictions' },
                    { id: 'CIS', label: 'Critical Infrastructure (CI) Report' },
                    { id: 'DPLH', label: 'ACH Report' }
                ];
                const intelStatuses = ['Not Required', 'Require', 'Already been Requested'];

                resourceItems.forEach(item => createRequestItem(item.id, item.label, resourceAndSupportStatuses, resourceContainer));
                supportItems.forEach(item => createRequestItem(item.id, item.label, resourceAndSupportStatuses, supportContainer));
                intelItems.forEach(item => createRequestItem(item.id, item.label, intelStatuses, intelContainer));
            }


            function setDispatchButtonsState(enabled) {
                copyBtn.disabled = !enabled;
                emailBtn.disabled = !enabled;
                smsBtn.disabled = !enabled;
            }

            function switchForm(selectedValue) {
                forms.forEach(form => form.classList.toggle('active', form.id === `${selectedValue}-form`));
                reportOutputContainer.style.display = 'none';
                generatedReportText = '';
                setDispatchButtonsState(false);
            }
            
            function getIncidentDetails() {
                const type = manualIncidentType.value || 'N/A';
                const location = manualLocation.value || 'N/A';
                const number = manualIncidentNumber.value || 'N/A';
                if (type === 'N/A' && location === 'N/A' && number === 'N/A') return null;
                const name = `${type} (${location}) - ${number}`;
                const subject = `${number}, ${type}, ${location}, Sitrep`;
                return { name, subject };
            }

            function updateIncidentName() {
                const type = toTitleCase(manualIncidentType.value.trim());
                const location = toTitleCase(manualLocation.value.trim());
                const autoName = (type && location) ? `${location} ${type}` : '';
                
                forms.forEach(form => {
                    const incidentNameInput = form.querySelector('input[name="Incident Name"]');
                    const nameManuallyCheckbox = form.querySelector('.name-manually-checkbox');
                    if (incidentNameInput && (!nameManuallyCheckbox || !nameManuallyCheckbox.checked)) {
                        incidentNameInput.value = autoName;
                    }
                });
            }

            function autoSelectChecklist(text) {
                const lowerText = text.toLowerCase();
                let newChecklistType = '';
                if (lowerText.includes('hazmat')) newChecklistType = 'hazmat';
                else if (lowerText.includes('active alarm') || lowerText.includes('structure')) newChecklistType = 'structure-fire';
                else if (lowerText.includes('bushfire')) newChecklistType = 'bushfire';
                else if (lowerText.includes('road crash') || lowerText.includes('rcr')) newChecklistType = 'road-crash';
                if (newChecklistType) {
                    checklistSelector.value = newChecklistType;
                    switchForm(newChecklistType);
                }
            }
            
            function parseIncidentTitle(title) {
                let incidentNumber = '', incidentType = '', incidentLocation = '';
                const cadMatch = title.match(/CAD-ID:\s*"?(\d+)"?/i);
                if (cadMatch && cadMatch[1]) incidentNumber = cadMatch[1].trim();
                const parenthesisIndex = title.indexOf('(');
                if (parenthesisIndex > -1) {
                    incidentType = title.substring(0, parenthesisIndex).trim();
                    const insideParenthesis = title.substring(parenthesisIndex + 1);
                    const commaIndex = insideParenthesis.indexOf(',');
                    if (commaIndex > -1) {
                        incidentLocation = insideParenthesis.substring(0, commaIndex).replace(/"/g, '').trim();
                    } else {
                        const closingParenIndex = insideParenthesis.indexOf(')');
                        if(closingParenIndex > -1) incidentLocation = insideParenthesis.substring(0, closingParenIndex).replace(/"/g, '').trim();
                    }
                }
                if (!incidentType && !incidentLocation && !incidentNumber) {
                     const parts = title.split(' - ');
                     incidentType = parts[0] ? parts[0].trim() : '';
                     incidentLocation = parts[1] ? parts[1].trim() : '';
                     incidentNumber = parts[2] ? parts[2].trim() : '';
                }
                return { number: incidentNumber, type: incidentType, location: incidentLocation };
            }

            function transformHazmatText(text) {
                const verbMap = {
                    'Approach': 'Approached', 'Assess': 'Assessed', 'Effect': 'Effected',
                    'Consider': 'Considered', 'Establish': 'Established', 'Determine': 'Determined',
                    'Identify': 'Identified', 'Record': 'Recorded', 'Use': 'Used',
                    'Complete': 'Completed', 'Transmit': 'Transmitted', 'Receive': 'Received',
                    'Re-assess': 'Re-assessed', 'Initiate': 'Initiated', 'Obtain': 'Obtained',
                    'Maintain': 'Maintained', 'Consult': 'Consulted', 'Recover': 'Recovered',
                    'Liaise': 'Liaised', 'Seek': 'Sought'
                };
                if (text.startsWith('DO NOT enter')) {
                    return text.replace('DO NOT enter', 'Did not enter');
                }
                if (text.startsWith('Full decontamination procedures are to be followed')) {
                    return text.replace('are to be followed', 'were followed');
                }
                const firstWord = text.split(' ')[0];
                if (verbMap[firstWord]) {
                    return text.replace(firstWord, verbMap[firstWord]);
                }
                return text;
            }

            globalIncidentSelector.addEventListener('change', (e) => {
                const selectedTitle = e.target.value;
                if (!selectedTitle) {
                    manualIncidentNumber.value = '';
                    manualIncidentType.value = '';
                    manualLocation.value = '';
                } else {
                    const parsed = parseIncidentTitle(selectedTitle);
                    manualIncidentNumber.value = parsed.number;
                    manualIncidentType.value = parsed.type;
                    manualLocation.value = parsed.location;
                }
                autoSelectChecklist(manualIncidentType.value);
                updateIncidentName();
            });

            [manualIncidentType, manualLocation, manualIncidentNumber].forEach(el => {
                el.addEventListener('input', () => {
                    updateIncidentName();
                    globalIncidentSelector.value = '';
                });
            });
            
            checklistSelector.addEventListener('change', (e) => {
                switchForm(e.target.value);
                updateIncidentName();
            });

            function generateReport() {
                const incidentDetails = getIncidentDetails();
                if (!incidentDetails) {
                    alert("Please select an incident or enter the details manually.");
                    return;
                }
                const activeForm = document.querySelector('.checklist-form.active');
                if (!activeForm) return;
                const formData = new FormData(activeForm);

                let authorLine = '';
                const authorRole = formData.get('ReportAuthorRole');
                
                if (authorRole) {
                    const completedBy = formData.get('Report Completed By') || 'N/A';
                    if (authorRole === 'is_ic') {
                        authorLine = `Report by: ${completedBy} (IC)\n`;
                    } else if (authorRole === 'on_behalf') {
                        const icName = formData.get('Incident Controller Author') || formData.get('Incident Controller Main') || '[IC Name Not Entered]';
                        authorLine = `Report completed by ${completedBy} on behalf of IC ${icName}\n`;
                    }
                } else { // Fallback for Ongoing Bushfire form
                    const author = formData.get('Report by') || 'N/A';
                    authorLine = `Report by: ${author}\n`;
                }

                let reportBody = `INCIDENT REPORT - ${checklistSelector.options[checklistSelector.selectedIndex].text.toUpperCase()}\n`;
                reportBody += `Report Time: ${new Date().toLocaleString()}\n`;
                reportBody += authorLine;
                reportBody += "----------------------------------------\n";

                if (activeForm.id !== 'ongoing-bushfire-form') {
                    reportBody += `INCIDENT: ${incidentDetails.name}\n`;
                    const arrivalCode = formData.get('Arrival Code');
                    if (arrivalCode) reportBody += `Arrival Code: ${arrivalCode}\n`;
                    const classification = formData.get('Classification');
                    if (classification) reportBody += `Incident Classification: ${classification}\n`;
                }

                // --- BUSHFIRE ---
                if (activeForm.id === 'bushfire-form') {
                    reportBody += "\n--- PAFTACS ---\n";
                    reportBody += `P - Position:\n`;
                    const latLong = formData.get('Lat/Long');
                    if (latLong) reportBody += `    Lat/Long: ${latLong}\n`;
                    const streetAddress = formData.get('Street Address');
                    if (streetAddress) reportBody += `    Street Address: ${streetAddress}\n`;
                    const direction = formData.get("Fire's Direction of Travel");
                    if (direction) reportBody += `    Fire's Direction of Travel: ${direction}\n`;
                    const propertyThreatened = formData.getAll('Property Threatened').join(', ');
                    if (propertyThreatened) reportBody += `    Property Threatened: ${propertyThreatened}\n`;
                    
                    reportBody += `\nA - Area Involved:\n`;
                    const areaUnit = formData.get('AreaUnit');
                    if (areaUnit === 'hectares') {
                        const areaHa = formData.get('Area (ha)');
                        if (areaHa) reportBody += `    ${areaHa} ha\n`;
                    } else if (areaUnit === 'metres') {
                        const m1 = formData.get('Area Metres 1');
                        const m2 = formData.get('Area Metres 2');
                        if (m1 && m2) {
                            const totalSqM = parseFloat(m1) * parseFloat(m2);
                            let areaDisplay;
                            if (totalSqM >= 10000) {
                                const hectares = totalSqM / 10000;
                                areaDisplay = `${hectares.toFixed(2)} ha`;
                            } else {
                                areaDisplay = `${totalSqM.toLocaleString()} m²`;
                            }
                            reportBody += `    ${m1}m x ${m2}m (${areaDisplay})\n`;
                        }
                    }

                    reportBody += `\nF - Fuel:\n`;
                    const fuelLoad = formData.get('Fuel Load');
                    const fuelType = formData.get('Fuel Type');
                    const fireIntensity = formData.get('Fire Intensity');
                    reportBody += `    ${fuelLoad}, ${fuelType}, ${fireIntensity}\n`;
                    
                    const time = formData.get('Time to Control');
                    if(time) reportBody += `\nT - Time to Control:\n    ${time}\n`;
                    
                    let assistanceBody = '';
                    const reportLabelMap = {
                        'AirSupport': 'Air Support', 'AssetProtect': 'Asset Protection',
                        'DFESOfficer': 'DFES Officer', 'IMTSupport': 'IMT Support', 'WAPOL': 'WAPOL',
                        'SJA': 'SJA', 'MainRoads': 'Main Roads', 'TrafficManagement': 'Traffic Management', 'LGA': 'LGA',
                        'Weather': 'IWF', 'Predictions': 'Predictions', 'CIS': 'CI Report', 'DPLH': 'ACH Report'
                    };
                    
                    let resourceBody = '';
                    if (formData.get('ApplianceStatus') === 'RequireAdditional') {
                        let applianceStr = '';
                        const applianceRequests = {
                            "FRS": formData.get('FRS Required'), "Heavies": formData.get('Heavies Required'),
                            "Lights": formData.get('Lights Required'), "Bulk Water": formData.get('Bulk Water Required'),
                        };
                        for (const [key, value] of Object.entries(applianceRequests)) {
                            if (value) applianceStr += `${key}: ${value}, `;
                        }
                        const machineryQty = formData.get('Machinery Required');
                        if (machineryQty) {
                            const machineryDesc = formData.get('Machinery Description');
                            applianceStr += `Machinery: ${machineryQty}${machineryDesc ? ` (${machineryDesc})` : ''}, `;
                        }
                        const otherQty = formData.get('Other Appliance Required');
                        if (otherQty) {
                            const otherDesc = formData.get('Other Appliance Description');
                            applianceStr += `Other: ${otherQty}${otherDesc ? ` (${otherDesc})` : ''}, `;
                        }
                        if (applianceStr) {
                            resourceBody += `    Additional Appliance Required: ${applianceStr.slice(0, -2)}\n`;
                        }
                        
                        ['AirSupport', 'AssetProtect'].forEach(id => {
                            const statusValue = formData.get(`Request-${id}`);
                            if (statusValue && statusValue.toLowerCase() !== 'notrequired') {
                                let statusText = statusValue.replace(/([A-Z])/g, ' $1').trim();
                                let viaText = '';
                                if (statusValue === 'AlreadybeenRequested') {
                                    statusText = 'Already been Requested';
                                    const viaValues = formData.getAll(`Request-${id}-via`);
                                    const otherVia = formData.get(`Request-${id}-via-other`);
                                    if (otherVia) {
                                        const otherIndex = viaValues.indexOf('on');
                                        if(otherIndex > -1) viaValues.splice(otherIndex, 1, `Other: ${otherVia}`);
                                    }
                                    if (viaValues.length > 0) viaText = ` (via ${viaValues.join(', ')})`;
                                }
                                resourceBody += `    - ${reportLabelMap[id]}: ${statusText}${viaText}\n`;
                            }
                        });
                    }
                    if(resourceBody) assistanceBody += '    --- Resources ---\n' + resourceBody;

                    let supportBody = '';
                    if (formData.get('SupportStatus') === 'Required') {
                        ['DFESOfficer', 'IMTSupport', 'WAPOL', 'SJA', 'MainRoads', 'TrafficManagement', 'LGA'].forEach(id => {
                            const statusValue = formData.get(`Request-${id}`);
                            if (statusValue && statusValue.toLowerCase() !== 'notrequired') {
                                let statusText = statusValue.replace(/([A-Z])/g, ' $1').trim();
                                let viaText = '';
                                if (statusValue === 'AlreadybeenRequested') {
                                    statusText = 'Already been Requested';
                                    const viaValues = formData.getAll(`Request-${id}-via`);
                                    const otherVia = formData.get(`Request-${id}-via-other`);
                                    if (otherVia) {
                                        const otherIndex = viaValues.indexOf('on');
                                        if(otherIndex > -1) viaValues.splice(otherIndex, 1, `Other: ${otherVia}`);
                                    }
                                    if (viaValues.length > 0) viaText = ` (via ${viaValues.join(', ')})`;
                                }
                                supportBody += `    - ${reportLabelMap[id]}: ${statusText}${viaText}\n`;
                            }
                        });
                    }
                    if(supportBody) assistanceBody += '    --- Support ---\n' + supportBody;

                    let intelBody = '';
                    if (formData.get('IntelStatus') === 'Required') {
                        ['Weather', 'Predictions', 'CIS', 'DPLH'].forEach(id => {
                            const statusValue = formData.get(`Request-${id}`);
                            if (statusValue && statusValue.toLowerCase() !== 'notrequired') {
                                let statusText = statusValue.replace(/([A-Z])/g, ' $1').trim();
                                let viaText = '';
                                if (statusValue === 'AlreadybeenRequested') {
                                    statusText = 'Already been Requested';
                                    const viaValues = formData.getAll(`Request-${id}-via`);
                                    const otherVia = formData.get(`Request-${id}-via-other`);
                                    if (otherVia) {
                                        const otherIndex = viaValues.indexOf('on');
                                        if(otherIndex > -1) viaValues.splice(otherIndex, 1, `Other: ${otherVia}`);
                                    }
                                    if (viaValues.length > 0) viaText = ` (via ${viaValues.join(', ')})`;
                                }
                                intelBody += `    - ${reportLabelMap[id]}: ${statusText}${viaText}\n`;
                            }
                        });
                    }
                    if(intelBody) assistanceBody += '    --- Intel ---\n' + intelBody;

                    const additionalDetails = formData.get('Additional Resource Details');
                    if (additionalDetails) {
                        assistanceBody += `    Additional Details: ${additionalDetails}\n`;
                    }

                    if (assistanceBody) {
                        reportBody += `\nA - Assistance Required:\n${assistanceBody}`;
                    }

                    reportBody += `\nC - Comms & Control:\n`;
                    const incidentName = formData.get('Incident Name');
                    if(incidentName) reportBody += `    Incident Name: ${incidentName}\n`;
                    
                    let managedUnder = formData.get('Managed Under');
                    if (managedUnder === 'Other') {
                        const otherText = formData.get('Managed Under Other');
                        managedUnder = otherText ? `Other: ${otherText}` : 'Other';
                    }
                    if (managedUnder) reportBody += `    Fire being managed under: ${managedUnder}\n`;

                    let agencies = formData.getAll('Controlling Agency');
                    const lgaName = formData.get('LGA Name');
                    if (lgaName) {
                        const lgaIndex = agencies.indexOf('LGA');
                        if (lgaIndex > -1) agencies[lgaIndex] = `LGA - ${lgaName}`;
                    }
                    if (agencies.length > 0) reportBody += `    Controlling Agency: ${agencies.join(', ')}\n`;

                    const commandChannel = formData.get('Command Channel');
                    if(commandChannel) reportBody += `    Command Channel: ${commandChannel}\n`;
                    const controlPoint = formData.get('Control Point');
                    if(controlPoint) reportBody += `    Control Point: ${controlPoint}\n`;
                    
                    const ic = formData.get('Incident Controller');
                    const ops = formData.get('Operations Officer');
                    const bflo = formData.get('BFLO');
                    if (ic || ops || bflo) {
                        reportBody += `    --- Command Structure ---\n`;
                        if(ic) reportBody += `        IC: ${ic}\n`;
                        if(ops) reportBody += `        OO: ${ops}\n`;
                        if(bflo) reportBody += `        BFLO: ${bflo}\n`;
                    }

                    reportBody += `\nS - Safety:\n`;
                    const wind = formData.get('Wind Direction and Strength');
                    if(wind) reportBody += `    Wind: ${wind}\n`;
                    const safety = formData.get('Safety Concerns');
                    if(safety) reportBody += `    Safety Concerns: ${safety}\n`;
                    
                    reportBody += "\n--- PUBLIC INFORMATION ---\n";
                    for (let i = 1; i <= 3; i++) {
                        const warningContainer = document.getElementById(`bf-warning-${i}-container`);
                        if (i > 1 && warningContainer.classList.contains('hidden-section')) continue;
                        const warning = formData.get(`Warning Level ${i}`);
                        if (warning && warning !== 'No Warning Required') {
                            reportBody += `\n--- WARNING AREA ${i} ---\n`;
                            reportBody += `Warning Type: ${warning}\n`;
                            const actionStatement = formData.get(`Action Statement ${i}`);
                            if (actionStatement) reportBody += `Action Statement: ${actionStatement}\n`;
                            const nBoundary = formData.get(`Northern Boundary ${i}`);
                            const eBoundary = formData.get(`Eastern Boundary ${i}`);
                            const sBoundary = formData.get(`Southern Boundary ${i}`);
                            const wBoundary = formData.get(`Western Boundary ${i}`);
                            if(nBoundary || eBoundary || sBoundary || wBoundary) {
                                reportBody += `Boundaries:\n`;
                                if(nBoundary) reportBody += `    (N): ${nBoundary}\n`;
                                if(eBoundary) reportBody += `    (E): ${eBoundary}\n`;
                                if(sBoundary) reportBody += `    (S): ${sBoundary}\n`;
                                if(wBoundary) reportBody += `    (W): ${wBoundary}\n`;
                            }
                        } else if (i === 1 && warning) {
                             reportBody += `Warning Type: ${warning}\n`;
                        }
                    }
                } 
                // --- STRUCTURE FIRE ---
                else if (activeForm.id === 'structure-fire-form') {
                    reportBody += "--- HAULER REPORT ---\n";
                    const height = formData.getAll('Height').join(', ') + (formData.get('Height Specify') ? `, ${formData.get('Height Specify')}` : '');
                    if (height) reportBody += `H - Height:\n    ${height}\n`;
                    
                    const areaDim1 = formData.get('Area Dim 1');
                    const areaDim2 = formData.get('Area Dim 2');
                    if(areaDim1 || areaDim2) reportBody += `A - Area/Size:\n    ${areaDim1 || 'N/A'} x ${areaDim2 || 'N/A'}\n`;

                    let use = formData.getAll('Use').join(', ') + (formData.get('Use Other') ? `, ${formData.get('Use Other')}` : '');
                    let walls = formData.getAll('Walls').join(', ') + (formData.get('Walls Other') ? `, ${formData.get('Walls Other')}` : '');
                    let roof = formData.getAll('Roof').join(', ') + (formData.get('Roof Other') ? `, ${formData.get('Roof Other')}` : '');
                    let asbestos = formData.getAll('Asbestos').join(', ');
                    if(use || walls || roof || asbestos) reportBody += `U - Use/Construction:\n`;
                    if(use) reportBody += `    Use: ${use}\n`;
                    if(walls) reportBody += `    Walls: ${walls}\n`;
                    if(roof) reportBody += `    Roof: ${roof}\n`;
                    if(asbestos) reportBody += `    Asbestos: ${asbestos}\n`;

                    let linesOfHose = formData.getAll('Lines of Hose').join(', ');
                    const linesOther = formData.get('Lines of Hose Other');
                    if (linesOther) linesOfHose += (linesOfHose ? ', ' : '') + `${linesOther} Lines`;
                    
                    let baTeams = formData.getAll('BA Teams').join(', ');
                    const baTeamsOther = formData.get('BA Teams Other');
                    if (baTeamsOther) baTeams += (baTeams ? ', ' : '') + `${baTeamsOther} Teams of BA`;

                    const actions = formData.getAll('Actions').join(', ') + (formData.get('Actions Other') ? `, ${formData.get('Actions Other')}` : '');
                    if(linesOfHose || baTeams || actions) reportBody += `L - Lines of Hose / Actions:\n`;
                    if(linesOfHose) reportBody += `    Lines of Hose: ${linesOfHose}\n`;
                    if(baTeams) reportBody += `    BA Teams: ${baTeams}\n`;
                    if(actions) reportBody += `    Actions: ${actions}\n`;

                    if(formData.getAll('Exposures').length > 0 || document.getElementById('sf-evacuation-checkbox').checked || formData.get('Life Involvement')) reportBody += `E - Exposures / Evacuations:\n`;
                    const exposures = formData.getAll('Exposures').join(', ');
                    if(exposures) reportBody += `    Exposures: ${exposures}\n`;
                    const exposureLocation = formData.get('Location of Exposures');
                    if(exposureLocation) reportBody += `    Exposure Location: ${exposureLocation}\n`;
                    if (document.getElementById('sf-evacuation-checkbox').checked) {
                        const evacuations = formData.get('Evacuations');
                        if(evacuations) reportBody += `    Evacuations: ${evacuations}\n`;
                    }
                    const lifeInvolvement = formData.get('Life Involvement');
                    if(lifeInvolvement) {
                        reportBody += `    Life Involvement: ${lifeInvolvement}\n`;
                        if(lifeInvolvement === 'Life Involvement Confirmed') {
                            const numUnaccounted = formData.get('Number of Persons Unaccounted for');
                            if(numUnaccounted) reportBody += `        Persons Unaccounted For: ${numUnaccounted}\n`;
                        } else if (lifeInvolvement === 'Life Involvement not confirmed') {
                            const possUnaccounted = formData.get('Possible Persons Unaccounted for');
                            if(possUnaccounted) reportBody += `        Possible Persons Unaccounted For: ${possUnaccounted}\n`;
                        }
                    }

                    let requiredResources = [];
                    const pumpQty = formData.get('Additional Pump Qty');
                    if (pumpQty) requiredResources.push(`Additional Pump (Qty: ${pumpQty})`);
                    formData.getAll('Resources Required').forEach(r => requiredResources.push(r));
                    const resRequiredOther = formData.get('Resources Required Other');
                    if (resRequiredOther) requiredResources.push(`Other: ${resRequiredOther}`);

                    const resAttendance = formData.getAll('Resources In Attendance').join(', ') + (formData.get('Resources In Attendance Other') ? `, ${formData.get('Resources In Attendance Other')}` : '');
                    if(requiredResources.length > 0 || resAttendance) reportBody += `R - Resources:\n`;
                    if(requiredResources.length > 0) reportBody += `    Required: ${requiredResources.join(', ')}\n`;
                    if(resAttendance) reportBody += `    In Attendance: ${resAttendance}\n`;

                    const sfIncidentName = formData.get('Incident Name');
                    let commandChannels = formData.getAll('Command Channel');
                    const otherChannel = formData.get('Command Channel Other');
                    if (otherChannel) commandChannels.push(otherChannel);
                    const sfControlPoint = formData.get('Control Point');
                    const sfIC = formData.get('Incident Controller Main');
                    const sfOO = formData.get('Operations Officer');
                    if(sfIncidentName || commandChannels.length > 0 || sfControlPoint || sfIC || sfOO) reportBody += `S - Staging / Safety:\n`;
                    if(sfIncidentName) reportBody += `    Incident Name: ${sfIncidentName}\n`;
                    if (commandChannels.length > 0) reportBody += `    Command Channel: ${commandChannels.join(', ')}\n`;
                    if(sfControlPoint) reportBody += `    Control Point: ${sfControlPoint}\n`;
                    if(sfIC) reportBody += `    IC: ${sfIC}\n`;
                    if(sfOO) reportBody += `    OO: ${sfOO}\n`;

                }
                // --- ROAD CRASH ---
                else if (activeForm.id === 'road-crash-form') {
                    reportBody += "\n--- RCR SITREP ---\n";
                    const situation = formData.getAll('Situation').join(', ') + (formData.get('Situation Other') ? `, ${formData.get('Situation Other')}` : '');
                    if(situation) reportBody += `Situation: ${situation}\n`;
                    const entrapment = formData.getAll('Entrapment').join(', ') + (formData.get('Entrapment Specify') ? `: ${formData.get('Entrapment Specify')}` : '');
                    if(entrapment) reportBody += `Entrapment: ${entrapment}\n`;
                    const hazards = formData.getAll('Hazards').join(', ') + (formData.get('Hazards Other') ? `, ${formData.get('Hazards Other')}` : '');
                    if(hazards) reportBody += `Hazards: ${hazards}\n`;
                    const actions = formData.getAll('Actions').join(', ') + (formData.get('Actions Other') ? `, ${formData.get('Actions Other')}` : '');
                    if(actions) reportBody += `Actions: ${actions}\n`;
                    
                    if(formData.getAll('Resources Required').length > 0 || formData.getAll('Resources In Attendance').length > 0) reportBody += `Resources:\n`;
                    const resRequired = formData.getAll('Resources Required').join(', ') + (formData.get('RCR Resources Required Other') ? `, ${formData.get('RCR Resources Required Other')}` : '');
                    if(resRequired) reportBody += `    Required: ${resRequired}\n`;
                    const resAttendance = formData.getAll('Resources In Attendance').join(', ') + (formData.get('RCR Resources In Attendance Other') ? `, ${formData.get('RCR Resources In Attendance Other')}` : '');
                    if(resAttendance) reportBody += `    In Attendance: ${resAttendance}\n`;
                    
                    const estTime = formData.get('Estimated Time');
                    if(estTime) reportBody += `Estimated Time on Scene: ${estTime}\n`;
                }
                // --- HAZMAT ---
                else if (activeForm.id === 'hazmat-form') {
                    reportBody += "\n--- HAZMAT REPORT ---\n";
                    const considerations = formData.getAll('Considerations').join(', ') + (formData.get('Considerations Other') ? `, ${formData.get('Considerations Other')}` : '');
                    if(considerations) reportBody += `Considerations: ${considerations}\n\n`;

                    activeForm.querySelectorAll('fieldset').forEach(fieldset => {
                        const legend = fieldset.querySelector('legend').textContent;
                        if (!legend.match(/^\d\./) && legend !== 'Protecting The Public') return;

                        let sectionBody = '';
                        fieldset.querySelectorAll('.hazmat-checklist-item, input[name="Public Protection"], textarea[name="Public Protection Notes"]').forEach(item => {
                            const checkbox = item.querySelector('input[type="checkbox"]');
                            if (checkbox && checkbox.checked) {
                                const label = item.querySelector('label').textContent.trim();
                                const notes = item.querySelector('input[type="text"]')?.value;
                                const transformedLabel = transformHazmatText(label);
                                sectionBody += `- ${transformedLabel}${notes ? ` (Notes: ${notes})` : ''}\n`;
                            } else if (item.matches('textarea') && item.value) {
                                sectionBody += `Notes: ${item.value}\n`;
                            }
                        });
                        if (sectionBody) {
                             reportBody += `${legend}\n${sectionBody}\n`;
                        }
                    });
                }
                // --- ONGOING BUSHFIRE ---
                else if (activeForm.id === 'ongoing-bushfire-form') {
                    const incidentName = formData.get('Incident Name');
                    if(incidentName) reportBody += `Incident name: ${incidentName}\n`;
                    const incidentStatus = formData.get('Incident Status');
                    if (incidentStatus) reportBody += `Incident status: ${incidentStatus}\n`;
                    const incidentLevel = formData.get('Incident Level');
                    if (incidentLevel) reportBody += `Incident Level: ${incidentLevel}\n`;
                    const managedUnder = formData.get('Managed Under');
                    if (managedUnder) reportBody += `Incident is being managed under: ${managedUnder}\n`;
                    
                    let agencies = formData.getAll('Controlling Agency');
                    const lgaName = formData.get('LGA Name');
                    if (lgaName) {
                        const lgaIndex = agencies.indexOf('LGA');
                        if (lgaIndex > -1) {
                            agencies[lgaIndex] = `LGA - ${lgaName}`;
                        }
                    }
                    if (agencies.length > 0) reportBody += `Controlling Agency: ${agencies.join(', ')}\n`;

                    const commandChannel = formData.get('Command Channel');
                    if (commandChannel) reportBody += `Command Channel: ${commandChannel}\n`;
                    const controlPoint = formData.get('Control Point');
                    if (controlPoint) reportBody += `Control point: ${controlPoint}\n`;
                    const fireSize = formData.get('Fire Size (ha)');
                    if (fireSize) reportBody += `Fire Size: ${fireSize} ha\n`;
                    
                    if (incidentStatus !== 'Contained and Controlled') {
                        const timeContained = formData.get('Estimated time until contained');
                        if (timeContained) {
                            const label = (incidentStatus === 'Contained and Not yet Controlled') ? 'Estimated time until Controlled' : 'Estimated time until contained';
                            reportBody += `${label}: ${timeContained}\n`;
                        }
                    }
                    
                    const timeSafe = formData.get('Estimated time until safe');
                    if (timeSafe) reportBody += `Estimated time until safe: ${timeSafe}\n`;
                    
                    reportBody += `--- IMT STRUCTURE ---\n`;
                    const imt_ic = formData.get('IMT IC'); if (imt_ic) reportBody += `IC: ${imt_ic}\n`;
                    const imt_oo = formData.get('IMT OO'); if (imt_oo) reportBody += `OO: ${imt_oo}\n`;
                    const imt_po = formData.get('IMT PO'); if (imt_po) reportBody += `PO: ${imt_po}\n`;
                    const imt_lo = formData.get('IMT LO'); if (imt_lo) reportBody += `LO: ${imt_lo}\n`;
                    const imt_pio = formData.get('IMT PIO'); if (imt_pio) reportBody += `PIO: ${imt_pio}\n`;

                    reportBody += `--- OBJECTIVES ---\n`;
                    for (let i = 1; i <= 5; i++) {
                        const obj = formData.get(`Objective ${i}`);
                        const status = formData.get(`Objective ${i} Status`);
                        if (obj) {
                            reportBody += `Objective ${i}: ${obj} (${status})\n`;
                        }
                    }

                    reportBody += `--- STRATEGIES ---\n`;
                    let strategy = formData.get('Strategies');
                    const strategyOther = formData.get('Strategies Other');
                    if (strategyOther) {
                        strategy += `, Other: ${strategyOther}`;
                    }
                    if (strategy) reportBody += `Strategies: ${strategy}\n`;

                    reportBody += `--- COMMUNITY WARNINGS ---\n`;
                    for (let i = 1; i <= 3; i++) {
                        const warningContainer = document.getElementById(`ob-warning-${i}-container`);
                        if (i > 1 && warningContainer.classList.contains('hidden-section')) continue;
                        const warning = formData.get(`Warning Level ${i}`);
                        if (warning && warning !== 'No Warning Required') {
                            if (i > 1) reportBody += `\n`;
                            reportBody += `--- WARNING AREA ${i} ---\n`;
                            reportBody += `Warning Type: ${warning}\n`;
                            const actionStatement = formData.get(`Action Statement ${i}`);
                            if (actionStatement) reportBody += `Action Statement: ${actionStatement}\n`;
                            const nBoundary = formData.get(`Northern Boundary ${i}`);
                            const eBoundary = formData.get(`Eastern Boundary ${i}`);
                            const sBoundary = formData.get(`Southern Boundary ${i}`);
                            const wBoundary = formData.get(`Western Boundary ${i}`);
                            if(nBoundary || eBoundary || sBoundary || wBoundary) {
                                reportBody += `Boundaries:\n`;
                                if(nBoundary) reportBody += `    (N): ${nBoundary}\n`;
                                if(eBoundary) reportBody += `    (E): ${eBoundary}\n`;
                                if(sBoundary) reportBody += `    (S): ${sBoundary}\n`;
                                if(wBoundary) reportBody += `    (W): ${wBoundary}\n`;
                            }
                        } else if (i === 1 && warning) {
                             reportBody += `Warning Type: ${warning}\n`;
                        }
                    }

                    const risks = formData.get('Key Identified Risks');
                    if (risks) reportBody += `--- KEY IDENTIFIED RISKS ---\n${risks}\n`;

                    let supportAgencies = formData.getAll('Support Agencies').join(', ');
                    const supportOther = formData.get('Support Agencies Other');
                    if (supportOther) supportAgencies += `, Other: ${supportOther}`;
                    if (supportAgencies) reportBody += `Support agencies on site: ${supportAgencies}\n`;

                    const relief = formData.get('Relief Management');
                    if (relief) {
                        let reliefStr = `Relief management: ${relief}`;
                        if (relief === 'Required') {
                            const reliefDetails = formData.get('Relief Required Details');
                            if (reliefDetails) reliefStr += `\n    Details: ${reliefDetails}`;
                        }
                        reportBody += `${reliefStr}\n`;
                    }

                    const isgUpdate = formData.get('ISG Update');
                    if (isgUpdate) {
                        let isgStr = `--- INCIDENT SUPPORT GROUP ---\nISG updates: ${isgUpdate}`;
                        if (isgUpdate === 'Scheduled') {
                            const details = formData.get('ISG Scheduled Details');
                            if (details) isgStr += ` (${details})`;
                        } else if (isgUpdate === 'Planned') {
                            const details = formData.get('ISG Planned Details');
                            if (details) isgStr += ` (${details})`;
                        }
                        reportBody += `${isgStr}\n`;
                    }

                    const furtherUpdate = formData.get('Further Update');
                    if (furtherUpdate) reportBody += `Further Update: ${furtherUpdate}\n`;
                }
                
                generatedReportText = reportBody;
                reportOutput.textContent = generatedReportText;
                reportOutputContainer.style.display = 'block';
                setDispatchButtonsState(true);
            }

            generateBtn.addEventListener('click', generateReport);

            copyBtn.addEventListener('click', () => {
                if (!generatedReportText || !navigator.clipboard) return;
                navigator.clipboard.writeText(generatedReportText).then(() => {
                    const originalText = copyBtn.textContent;
                    copyBtn.textContent = 'Copied!';
                    setTimeout(() => { copyBtn.textContent = originalText; }, 2000);
                }).catch(err => console.error('Failed to copy text: ', err));
            });

            emailBtn.addEventListener('click', () => {
                if (!generatedReportText) return;
                const emailRecipient = "comcen.comcen2@dfes.wa.gov.au";
                const incidentDetails = getIncidentDetails();
                let subject = 'Sitrep';
                if (incidentDetails) subject = incidentDetails.subject;
                const mailtoLink = `mailto:${emailRecipient}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(generatedReportText)}`;
                window.open(mailtoLink, '_blank');
            });

            smsBtn.addEventListener('click', () => {
                if (!generatedReportText) return;
                const smsRecipient = prompt("Enter recipient's phone number:");
                if (smsRecipient) {
                    const smsLink = `sms:${smsRecipient}?&body=${encodeURIComponent(generatedReportText)}`;
                    window.open(smsLink, '_blank');
                }
            });

            // --- Initial Setup ---
            initializeButtonGroups();
            initializeBushfireRequests();
            initializeInteractiveInputs();
            fetchAndPopulateIncidents();
            setInterval(fetchAndPopulateIncidents, 120000);
            ['bf', 'ob'].forEach(prefix => {
                for (let i = 1; i <= 3; i++) {
                    const dropdown = document.getElementById(`${prefix}-action-statement-${i}`);
                    if (dropdown) updateActionStatementDropdown('', dropdown);
                }
            });
            switchForm(checklistSelector.value);
            updateIncidentName();
        });
    </script>

</body>
</html>
